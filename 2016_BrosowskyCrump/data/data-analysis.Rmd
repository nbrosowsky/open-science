---
output: html_document
---

```{r,echo=FALSE}
require(ggplot2)
require(plyr)
require(pander)
require(knitr)
require(xtable)
require(car)
require(Crump)
require(lsr)
require(afex)
```



## Shortcuts:

## [Exp. 1](#exp1)

## [Exp. 2](#exp2)

## [Exp. 3](#exp3)

## [Exp. 4](#exp4)

<a name="exp1"></a>



Dimensional Memory V1
========================================================

Participants were presented with four letters superimposed on four color squares. The location of the colors and letters were randomized from trial-to-trial; each letter and color placed in one of four horizontal positions. Trial stimuli was either presented above or below the fixation point (50% prob.)

After stimulus presentation participants were either asked to report a letter at a particular location, or a color (task).

For example: what was the the letter in the third position?

There was no training. Participants were not aware of the proportion manipulation.
480 Trials total.
Each location (upper/lower) was associated with a higher probability of a certain task. 
high proportion: 75%


Results: 
Accuracy was very low for a number of participants. Participants with accuracy less than 50% were removed (calc. for 75/25 & col/let blocks).

 Accuracy and response time was significantly better for color trials 
 
 No context-dependent proportion effects
  
  There was a task switch effect (RT and ACC were better for repeated task trials), but no location switch effect




# Exp. V1
## Read data into dataframe

```{r}
load("data_E1.Rda")
AllData<-data_E1
rm(data_E1)
```



#Compare Task ACC
```{r}

Task.ACC<-ddply(AllData,.(Subject,TrialType,TargetType),summarise,ACC=mean(task.ACC))

ggplot(Task.ACC,aes(x=Subject, y=ACC,color=TargetType))+
  geom_point(size=3)+
  theme_classic(base_size=15)+
  ylab("Proportion Correct")+
  xlab("Subject")+
  ylim(0,1)+
  theme(legend.position="top",
    legend.direction="horizontal",
    legend.title = element_blank())+
  facet_wrap(~TrialType)

#Task.ACC<-Task.ACC[(order(Task.ACC$ACC)),]
#kable(Task.ACC,format="markdown")



```


#Exp. 1
#Basic Analysis of All Trials
## Error Rates

Some basic checks on the data to identify subjects that have completed the task properly

```{r}
AllDatanew<-AllData
AllDatanew<-AllDatanew[AllDatanew$RTs>0,]
AllDatanew<-AllDatanew[AllDatanew$RTs<5000,]


ExploreDF<-ddply(AllDatanew,.(Subject,TrialType,TargetType),summarise,meanRT=mean(RTs),meanAccuracy=mean(ACC),TrialsCompleted=length(RTs),maxRT=max(RTs),vjoutRT=mean(vjout(RTs)$data),removed=vjout(RTs)$pr)
CorruptedData<-ExploreDF[ExploreDF$meanRT<0,]$Subject
CorruptedData

CleanDF<-ExploreDF[ExploreDF$Subject%in%CorruptedData==FALSE,]

ggplot(CleanDF,aes(x=vjoutRT, y=meanAccuracy,color=Subject))+
  geom_point()+
  theme_classic(base_size=15)+
  ylab("Proportion Correct")+
  xlab("Mean Reaction Time (ms")+
  ylim(0,1)+
  theme(legend.position="top",
    legend.direction="horizontal",
    legend.title = element_blank())

kable(CleanDF,format="markdown")

#min ACC
print(min(CleanDF$meanAccuracy))
#Max maxRT
print(max(CleanDF$maxRT))
```



#Exp. 1
# Accuracy Analysis
## TargetType X TrialType

```{r}

AllDatanew2<-AllDatanew

ACC.p75<-c()
ACC.p75<-AllDatanew2[AllDatanew2$Subject%in%CorruptedData==FALSE,]
#ACC.p75<-ACC.p75[ACC.p75$block=="B2",]

#Print table of means
ACC.analysis<-ddply(ACC.p75,.(Subject,TrialType,TargetType),summarise,ACC=mean(ACC))
Exp1.tables <- ddply(ACC.analysis, c("TrialType","TargetType"), summarise,
               N    = length(ACC),
               mean = mean(ACC),
               sd   = sd(ACC),
               se   = sd / sqrt(N)
               )
kable(xtable(Exp1.tables),type="html")

#ANOVA Proportion x TargetType
ACC.analysis<-ddply(ACC.p75,.(Subject,TrialType,TargetType),summarise,ACC=mean(ACC))
ACC.analysis$Subject<-factor(ACC.analysis$Subject)
aov.out<-aov(ACC~TrialType*TargetType + Error(Subject/(TrialType*TargetType)),ACC.analysis)
Exp1.ACC75.table<-kable(xtable(aov.out),type="html")
Exp1.ACC75.table


aov.out<-aov_car(ACC ~ TrialType * TargetType + Error(Subject/(TrialType*TargetType)), 
        data = ACC.analysis)

nice(aov.out, es = "pes", observed = NULL,
    correction = c("none"), MSE = TRUE,
    sig.symbols = c(" +", " *", " **", " ***"))




#Plot Proportion X TargetType
limits <- aes(ymax = mean + se, ymin = mean - se)
Exp1.ACC75.plot<-ggplot(Exp1.tables,aes(x=TrialType, y=mean,fill=TargetType))+
  geom_bar(stat="identity", position=position_dodge(width=0.9)) + 
  scale_fill_manual(values=c("#56B4E9", "#009E73"))+
  geom_errorbar(limits, width = .2, position=position_dodge(width=0.9))+
  coord_cartesian(ylim = c(0, 1))+
  theme_classic(base_size=20)+
  labs(title="")+
  ylab("Accuracy (%)")+
  xlab("Proportion")+
  theme(legend.position="top",legend.direction="horizontal",legend.title = element_blank())

Exp1.ACC75.plot

## Using proportion rather than location as grouping 
AllDatanew2<-AllDatanew

ACC.p75<-c()
ACC.p75<-AllDatanew2[AllDatanew2$Subject%in%CorruptedData==FALSE,]
#ACC.p75<-ACC.p75[ACC.p75$block=="B2",]

#Print table of means
ACC.analysis<-ddply(ACC.p75,.(Subject,Proportion,TargetType),summarise,ACC=mean(ACC))
Exp1.tables <- ddply(ACC.analysis, c("TargetType","Proportion"), summarise,
               N    = length(ACC),
               mean = mean(ACC),
               sd   = sd(ACC),
               se   = sd / sqrt(N)
               )
kable(xtable(Exp1.tables),type="html")

#ANOVA Proportion x TargetType
ACC.analysis<-ddply(ACC.p75,.(Subject,Proportion,TargetType),summarise,ACC=mean(ACC))
ACC.analysis$Subject<-factor(ACC.analysis$Subject)
aov.out<-aov(ACC~Proportion*TargetType + Error(Subject/(Proportion*TargetType)),ACC.analysis)
Exp1.ACC75.table<-kable(xtable(aov.out),type="html")
Exp1.ACC75.table


aov.out<-aov_car(ACC ~ TargetType * Proportion + Error(Subject/(TargetType*Proportion)), 
        data = ACC.analysis)

nice(aov.out, es = "pes", observed = NULL,
    correction = c("none"), MSE = TRUE,
    sig.symbols = c(" +", " *", " **", " ***"))




#Plot Proportion X TargetType
limits <- aes(ymax = mean + se, ymin = mean - se)
Exp1.ACC75.plot<-ggplot(Exp1.tables,aes(x=TargetType, y=mean,fill=Proportion))+
  geom_bar(stat="identity", position=position_dodge(width=0.9)) + 
  scale_fill_manual(values=c("#56B4E9", "#009E73"))+
  geom_errorbar(limits, width = .2, position=position_dodge(width=0.9))+
  coord_cartesian(ylim = c(0, 1))+
  theme_classic(base_size=20)+
  labs(title="")+
  ylab("Accuracy (%)")+
  xlab("Proportion")+
  theme(legend.position="top",legend.direction="horizontal",legend.title = element_blank())

Exp1.ACC75.plot
```

#Exp. 1
# RT Analysis
## TargetType X Proportion: 75/25P Trials

```{r}

AllDatanew2<-AllDatanew

RT.p75<-c()
RT.p75<-AllDatanew2[AllDatanew2$Subject%in%CorruptedData==FALSE,]
RT.p75<-RT.p75[RT.p75$ACC==1,]
#ACC.p75<-ACC.p75[ACC.p75$block=="B2",]

#Print table of means
RT.analysis<-ddply(RT.p75,.(Subject,TrialType,TargetType),summarise,RTs=mean(vjout(RTs)$data))
Exp1.tables <- ddply(RT.analysis, c("TrialType","TargetType"), summarise,
               N    = length(RTs),
               mean = mean(RTs),
               sd   = sd(RTs),
               se   = sd / sqrt(N)
               )
kable(xtable(Exp1.tables),type="html")

#ANOVA Proportion x TargetType
RT.analysis<-ddply(RT.p75,.(Subject,TrialType,TargetType),summarise,RTs=mean(vjout(RTs)$data))
RT.analysis$Subject<-factor(RT.analysis$Subject)
aov.out<-aov(RTs~TrialType*TargetType + Error(Subject/(TrialType*TargetType)),RT.analysis)
Exp1.RT75.table<-kable(xtable(aov.out),type="html")
Exp1.RT75.table

#print(summary(aov.out),digits=10)
#print(model.tables(aov.out,"means"),format="markdown")


#Plot Proportion X TargetType
limits <- aes(ymax = mean + se, ymin = mean - se)
Exp1.RT75.plot<-ggplot(Exp1.tables,aes(x=TrialType, y=mean,fill=TargetType))+
  geom_bar(stat="identity", position=position_dodge(width=0.9)) + 
  scale_fill_manual(values=c("#56B4E9", "#009E73"))+
  geom_errorbar(limits, width = .2, position=position_dodge(width=0.9))+
  coord_cartesian(ylim = c(1500,2000 ))+
  theme_classic(base_size=20)+
  labs(title="")+
  ylab("RTuracy (%)")+
  xlab("Proportion")+
  theme(legend.position="top",legend.direction="horizontal",legend.title = element_blank())

Exp1.RT75.plot

#Using Proportion as the grouping variable

RT.analysis<-ddply(RT.p75,.(Subject,Proportion,TargetType),summarise,RTs=mean(vjout(RTs)$data))
Exp1.tables <- ddply(RT.analysis, c("Proportion","TargetType"), summarise,
               N    = length(RTs),
               mean = mean(RTs),
               sd   = sd(RTs),
               se   = sd / sqrt(N)
               )
kable(xtable(Exp1.tables),type="html")



#ANOVA Proportion x TargetType
RT.analysis<-ddply(RT.p75,.(Subject,Proportion,TargetType),summarise,RTs=mean(vjout(RTs)$data))
RT.analysis$Subject<-factor(RT.analysis$Subject)
aov.out<-aov(RTs~Proportion*TargetType + Error(Subject/(Proportion*TargetType)),RT.analysis)
Exp1.RT75.table<-kable(xtable(aov.out),type="html")
Exp1.RT75.table
#print(summary(aov.out),digits=10)
#print(model.tables(aov.out,"means"),format="markdown")


#Plot Proportion X TargetType
limits <- aes(ymax = mean + se, ymin = mean - se)
Exp1.RT75.plot<-ggplot(Exp1.tables,aes(x=TargetType, y=mean,fill=Proportion))+
  geom_bar(stat="identity", position=position_dodge(width=0.9)) + 
  scale_fill_manual(values=c("#56B4E9", "#009E73"))+
  geom_errorbar(limits, width = .2, position=position_dodge(width=0.9))+
  coord_cartesian(ylim = c(1500,2000 ))+
  theme_classic(base_size=20)+
  labs(title="")+
  ylab("RTuracy (%)")+
  xlab("Proportion")+
  theme(legend.position="top",legend.direction="horizontal",legend.title = element_blank())

Exp1.RT75.plot


```



<a name="exp2"></a>


## Shortcuts:

## [Exp. 1](#exp1)

## [Exp. 2](#exp2)

## [Exp. 3](#exp3)

Dimensional Memory V2
========================================================

Participants were presented with four letters superimposed on four color squares. The location of the colors and letters were randomized from trial-to-trial; each letter and color placed in one of four horizontal positions. Trial stimuli was either presented above or below the fixation point (50% prob.)

After stimulus presentation participants were either asked to report a letter at a particular location, or a color (task).

For example: what was the the letter in the third position?

Participants were not told about the proportion manipulation in blocks 3 & 4

Trials were split into 4 blocks: 1 & 2 were training, 3 & 4 were mixed trials

Training: only one task type in it's high proportion location

 Mixed Trials: All trials mixed together. Each location (upper/lower) was associated with a higher probability of a certain task. 
high proportion: 75%

 480 Trials total.

Results: 

 Accuracy and response time was significantly better for color trials 
 
 No context-dependent proportion effects
  
  There was a task switch effect (RT and ACC were better for repeated task trials), but no location switch effect

## Read data into dataframe

```{r}

setwd("~/Dropbox/Research/Projects/2015\ DimensionalMemory/Experimentfiles/DimensionalMemory\ V2/data")

subject_data<-c()
subject_data <- list.files(pattern=".*txt")

AllData<-data.frame()
single_sub<-c()
input<-c()
data_info<-c()
alldata_info<-c()

for (i in seq(1:length(subject_data))){
  input<-scan(file=subject_data[i], what = "character",skip=(0))

    datatable<-matrix(input,ncol=13,byrow=T)
    Subject<-c(rep(i,nrow(datatable)))
    
    data_info<-c(subject_data[i],length(input),nrow(datatable))
    
    Proportion<-c(datatable[,10])
    TrialType<-c(datatable[,7])
    TargetType<-c(datatable[,8])
    TargetPosition<-c(datatable[,9])
    RTs<-c(as.numeric(datatable[,12])-as.numeric(datatable[,11]))  
#number of trials
    Trial<-c(seq(1:nrow(datatable)))
    Block<-c(rep(1,128),rep(2,128),rep(3,128),rep(4,nrow(datatable)-(3*128)))

#First four participants had b/g keys swapped
    if (i < 5){
      Response<-recode(datatable[,13],"c('a','A')= 'a';c('s','S')='e';c('d','D')='o';c('f','F')='c';c('h','H')='r';c('j','J')='g';c('k','K')='b';c('l','L')='y'")  
   }else{
      Response<-recode(datatable[,13],"c('a','A')= 'a';c('s','S')='e';c('d','D')='o';c('f','F')='c';c('h','H')='r';c('j','J')='b';c('k','K')='g';c('l','L')='y'")
  }    

#separate letter targets
    Letters<-c(unlist(strsplit(datatable[,1],"")))
    LettersM<-matrix(Letters,ncol=4,byrow=T)

#recode color words to single letters to compute accuracy
    ColorP1<-recode(datatable[,2],"'red'= 'r';'blue'='b';'green'='g';'yellow'='y'")
    ColorP2<-recode(datatable[,3],"'red'= 'r';'blue'='b';'green'='g';'yellow'='y'")
    ColorP3<-recode(datatable[,4],"'red'= 'r';'blue'='b';'green'='g';'yellow'='y'")
    ColorP4<-recode(datatable[,5],"'red'= 'r';'blue'='b';'green'='g';'yellow'='y'")
    ColorsM<-cbind(ColorP1,ColorP2,ColorP3,ColorP4)

  P75Recode<-c(datatable[1,6],datatable[1,7],datatable[129,6],datatable[129,7])

#Recode the proper 75/25 levels 
## FIX the TRIALTYPE variable to have proper labels
for (n in seq(1:nrow(datatable))){
  if (datatable[n,7]==P75Recode[2] && datatable[n,6]==P75Recode[3]){
    Proportion[n]<-c("25P")
    TrialType[n]<-c(P75Recode[4])
    }else{
      if (datatable[n,7]==P75Recode[4] && datatable[n,6]==P75Recode[1]){
    Proportion[n]<-c("25P")
    TrialType[n]<-c(P75Recode[2])
    }
    }
}


#Compute accuracy   
ACC<-c()
for (i in seq(1:nrow(datatable))){
  for (n in seq(1:4)){
  if (TargetType[i]=="Let" && TargetPosition[i]==n){
    if (Response[i]==LettersM[i,n]){
      ACC[i]<-1
      }else
        {ACC[i]<-0}
      } 
    }
  for (n in seq(1:4)){
  if (TargetType[i]=="Col" && TargetPosition[i]==n){
    if (Response[i]==ColorsM[i,n]){
      ACC[i]<-1
      }else
        {ACC[i]<-0}
      } 
    }
  }


#code change and repeat trials
Task.switch<-c("First")
Loc.switch<-c("First")

for (n in seq((nrow(datatable)-1))){
  if (datatable[n+1,6]==datatable[n,6]){
    Loc.switch[n+1]<-c("L.Repeat")
    }else{
      Loc.switch[n+1]<-c("L.Change")
    }
  if (datatable[n+1,7]==datatable[n,7]){
    Task.switch[n+1]<-c("T.Repeat")
    }else{
      Task.switch[n+1]<-c("T.Change")
    }
  }

Task.switch[257]<-c("First")
Loc.switch[257]<-c("First")

#Recode the trial type so first two blocks are "training"
for (n in (1:nrow(datatable))){
  if (datatable[n,10]=="100P" && datatable[n,8]=="Col"){
  TrialType[n]<-"Training"
  }
  if (datatable[n,10]=="100P" && datatable[n,8]=="Let"){
    TrialType[n]<-"Training"
  }
}


#Check to make sure the o/e and b/g keys were not swapped for anyone else. 
#Compute a second accuracy with the keys flipped to compare

Response2<-recode(datatable[,13],"c('a','A')= 'a';c('s','S')='o';c('d','D')='e';c('f','F')='c';c('h','H')='r';c('j','J')='g';c('k','K')='b';c('l','L')='y'")  
#number of trials

c.response<-c()
ACC2<-c()
for (i in seq(1:nrow(datatable))){
  for (n in seq(1:4)){
  if (TargetType[i]=="Let" && TargetPosition[i]==n){
    c.response[i]<-LettersM[i,n]
    if (Response2[i]==LettersM[i,n]){
      ACC2[i]<-1
      }else
        {ACC2[i]<-0}
      } 
    }
  for (n in seq(1:4)){
  if (TargetType[i]=="Col" && TargetPosition[i]==n){
     c.response[i]<-ColorsM[i,n]
    if (Response2[i]==ColorsM[i,n]){
      ACC2[i]<-1
      }else
        {ACC2[i]<-0}
      } 
    }
  }

task.ACC<-c()
for (i in seq(1:nrow(datatable))){
  for (n in seq(1:4)){
  if (TargetType[i]=="Let"){
    if (Response[i]=="a" | Response[i]=="o" | Response[i]=="e" | Response[i]=="c"){
      task.ACC[i]<-1
      }else
        {task.ACC[i]<-0}
      } 
    }
  for (n in seq(1:4)){
  if (TargetType[i]=="Col"){
    if (Response[i]=="r" | Response[i]=="b" | Response[i]=="g" | Response[i]=="y"){
      task.ACC[i]<-1
      }else
        {task.ACC[i]<-0}
      } 
    }
  }

wrong.task<-c()
for (i in seq(1:nrow(datatable))){
  for (n in seq(1:4)){
  if (TargetType[i]=="Col"){
    if (Response[i]=="a" | Response[i]=="o" | Response[i]=="e" | Response[i]=="c"){
      wrong.task[i]<-1
      }else
        {wrong.task[i]<-0}
      } 
    }
  for (n in seq(1:4)){
  if (TargetType[i]=="Let"){
    if (Response[i]=="r" | Response[i]=="b" | Response[i]=="g" | Response[i]=="y"){
      wrong.task[i]<-1
      }else
        {wrong.task[i]<-0}
      } 
    }
  }


    single_sub<-data.frame(Subject,TargetPosition,Proportion,RTs,ACC,Task.switch,Loc.switch,TargetType,TrialType,ACC2,c.response,Response,task.ACC,wrong.task,Block)
    AllData<-rbind(AllData,single_sub)
    alldata_info<-rbind(alldata_info,data_info)
  }

#check<-ddply(AllData,.(Subject,c.response),summarise,ACC=mean(ACC),ACC2=mean(ACC2))
#check<-check[check$c.response=="b" | check$c.response=="g",]
#check

#check<-ddply(AllData,.(Subject,c.response),summarise,ACC=mean(ACC),ACC2=mean(ACC2))
#check<-check[check$c.response=="o" | check$c.response=="e",]
#check
#print(alldata_info)
```



#Compare Task ACC
```{r}

Task.ACC<-ddply(AllData,.(Subject,TrialType,TargetType),summarise,ACC=mean(task.ACC))

ggplot(Task.ACC,aes(x=Subject, y=ACC,color=TargetType))+
  geom_point(size=3)+
  theme_classic(base_size=15)+
  ylab("Proportion Correct")+
  xlab("Subject")+
  ylim(0,1)+
  theme(legend.position="top",
    legend.direction="horizontal",
    legend.title = element_blank())+
  facet_wrap(~TrialType)

#Task.ACC<-Task.ACC[(order(Task.ACC$ACC)),]
#kable(Task.ACC,format="markdown")



```

#Exp. 2
#Basic Analysis of All Trials
## Subject RTs and Error Rates

Some basic checks on the data to identify subjects that have completed the task properly

```{r}

AllDatanew<-AllData
AllDatanew<-AllDatanew[AllDatanew$RTs>0,]
AllDatanew<-AllDatanew[AllDatanew$RTs<5000,]
#AllDatanew<-AllDatanew[AllDatanew$Subject!=21,]
#AllDatanew<-AllDatanew[AllDatanew$Subject!=18,]


ExploreDF<-ddply(AllDatanew,.(Subject,TrialType,TargetType),summarise,meanRT=mean(RTs),meanAccuracy=mean(ACC),TrialsCompleted=length(RTs),maxRT=max(RTs),vjoutRT=mean(vjout(RTs)$data),removed=vjout(RTs)$pr)
CorruptedData<-ExploreDF[ExploreDF$meanRT<0,]$Subject
CorruptedData

CleanDF<-ExploreDF[ExploreDF$Subject%in%CorruptedData==FALSE,]

ggplot(CleanDF,aes(x=vjoutRT, y=meanAccuracy,color=TrialType))+
  geom_point()+
  theme_classic(base_size=15)+
  ylab("Proportion Correct")+
  xlab("Mean Reaction Time (ms")+
  ylim(0,1)+
  theme(legend.position="top",
    legend.direction="horizontal",
    legend.title = element_blank())

kable(CleanDF,format="markdown")

#min ACC
print(min(CleanDF$meanAccuracy))
#Max maxRT
print(max(CleanDF$maxRT))

```



#Exp. 2
# Accuracy Analysis
## TargetType X TrialType: as 2-level factor (excluding 100/training)

```{r}

ACC.all<-c()
ACC.all<-AllDatanew[AllDatanew$Subject%in%CorruptedData==FALSE,]


#ACC.all<-ACC.all[ACC.all$task.ACC==0,]

ACC.all<-ACC.all[ACC.all$TrialType != "Training",]
ACC.all$TrialType<-factor(ACC.all$TrialType)
ACC.analysis<-ddply(ACC.all,.(Subject ,TrialType,TargetType),summarise,ACC=mean(ACC))

#Print table of means
ACC.table <- ddply(ACC.analysis, c("TrialType","TargetType"), summarise,
               N    = length(ACC),
               mean = mean(ACC),
               sd   = sd(ACC),
               se   = sd / sqrt(N)
               )
kable(xtable(ACC.table),type="html")

#ANOVA on Proportion X TargetType
ACC.analysis$Subject<-factor(ACC.analysis$Subject)
ACC.analysis$TrialType<-factor(ACC.analysis$TrialType)
ACC.analysis$TargetType<-factor(ACC.analysis$TargetType)
aov.out<-aov(ACC~(TrialType*TargetType) + (Error(Subject/(TrialType*TargetType))),ACC.analysis)
Exp2.ACC.table<-kable(xtable(aov.out),type="html")
Exp2.ACC.table

aov.out<-aov_car(ACC ~ TrialType * TargetType + Error(Subject/(TrialType*TargetType)), 
        data = ACC.analysis)

nice(aov.out, es = "pes", observed = NULL,
    correction = c("none"), MSE = TRUE,
    sig.symbols = c(" +", " *", " **", " ***"))

#print(summary(aov.out),digits=10)
#print(model.tables(aov.out,"means"),format="markdown")


ACC.analysis1<-ACC.analysis[ACC.analysis$TrialType!="Training",]
aov.out<-aov(ACC~TrialType*TargetType + Error(Subject/(TrialType*TargetType)),ACC.analysis1)
Exp2.ACC.table<-kable(xtable(aov.out),type="html")
Exp2.ACC.table

ACC.analysis1$Phase<-"Mixed"
#print(summary(aov.out),digits=10)
#print(model.tables(aov.out,"means"),format="markdown")



limits <- aes(ymax = mean + se, ymin = mean - se)
Exp2.ACC.plot<-ggplot(ACC.table,aes(x=TrialType, y=mean,fill=TargetType))+
  geom_bar(stat="identity", position=position_dodge(width=.9)) + 
  geom_errorbar(limits, width = .2, position=position_dodge(width=.9))+
  #scale_fill_manual(values=c("tomato2", "dodgerblue2", "seagreen4"))+
  scale_fill_manual(values=c("#56B4E9", "#009E73"))+
  coord_cartesian(ylim = c(0, 1))+
  theme_classic(base_size=20)+
  labs(title="Exp. 2")+
  ylab("Accuracy (%)")+
  xlab("Proportion")+
  theme(legend.position="top",legend.direction="horizontal",legend.title = element_blank())
Exp2.ACC.plot

#Run pairwise t-tests with Holm correction

ACC.1<-ACC.analysis[ACC.analysis$TrialType=="HighCol",]
print(with(ACC.1, pairwise.t.test(ACC,TargetType, paired=T)))

ACC.1<-ACC.analysis[ACC.analysis$TrialType=="HighLet",]
print(with(ACC.1, pairwise.t.test(ACC,TargetType, paired=T)))


### USE PROPORTION AS THE GROUPING FACTOR ####
ACC.all<-c()
ACC.all<-AllDatanew[AllDatanew$Subject%in%CorruptedData==FALSE,]


#ACC.all<-ACC.all[ACC.all$task.ACC==0,]

ACC.all<-ACC.all[ACC.all$Proportion != "100P",]
ACC.all$Proportion<-factor(ACC.all$Proportion)
ACC.analysis<-ddply(ACC.all,.(Subject ,Proportion,TargetType),summarise,ACC=mean(ACC))

#Print table of means
ACC.table <- ddply(ACC.analysis, c("TargetType","Proportion"), summarise,
               N    = length(ACC),
               mean = mean(ACC),
               sd   = sd(ACC),
               se   = sd / sqrt(N)
               )
kable(xtable(ACC.table),type="html")

#ANOVA on Proportion X TargetType
ACC.analysis$Subject<-factor(ACC.analysis$Subject)
ACC.analysis$Proportion<-factor(ACC.analysis$Proportion)
ACC.analysis$TargetType<-factor(ACC.analysis$TargetType)
aov.out<-aov(ACC~(Proportion*TargetType) + (Error(Subject/(Proportion*TargetType))),ACC.analysis)
Exp2.ACC.table<-kable(xtable(aov.out),type="html")
Exp2.ACC.table

aov.out<-aov_car(ACC ~ Proportion * TargetType + Error(Subject/(Proportion*TargetType)), 
        data = ACC.analysis)

nice(aov.out, es = "pes", observed = NULL,
    correction = c("none"), MSE = TRUE,
    sig.symbols = c(" +", " *", " **", " ***"))

#print(summary(aov.out),digits=10)
#print(model.tables(aov.out,"means"),format="markdown")


ACC.analysis1<-ACC.analysis[ACC.analysis$Proportion!="100P",]
aov.out<-aov(ACC~Proportion*TargetType + Error(Subject/(Proportion*TargetType)),ACC.analysis1)
Exp2.ACC.table<-kable(xtable(aov.out),type="html")
Exp2.ACC.table



limits <- aes(ymax = mean + se, ymin = mean - se)
Exp2.ACC.plot<-ggplot(ACC.table,aes(x=TargetType, y=mean,fill=Proportion))+
  geom_bar(stat="identity", position=position_dodge(width=.9)) + 
  geom_errorbar(limits, width = .2, position=position_dodge(width=.9))+
  #scale_fill_manual(values=c("tomato2", "dodgerblue2", "seagreen4"))+
  scale_fill_manual(values=c("#56B4E9", "#009E73"))+
  coord_cartesian(ylim = c(0, 1))+
  theme_classic(base_size=20)+
  labs(title="Exp. 2")+
  ylab("Accuracy (%)")+
  xlab("Proportion")+
  theme(legend.position="top",legend.direction="horizontal",legend.title = element_blank())
Exp2.ACC.plot

#Run pairwise t-tests with Holm correction

ACC.1<-ACC.analysis[ACC.analysis$TargetType=="Let",]
print(with(ACC.1, pairwise.t.test(ACC,Proportion, paired=T)))

ACC.1<-ACC.analysis[ACC.analysis$TargetType=="Col",]
print(with(ACC.1, pairwise.t.test(ACC,Proportion, paired=T)))
```

# Analyze Training Block

```{r}
ACC.all<-c()
ACC.all<-AllDatanew[AllDatanew$Subject%in%CorruptedData==FALSE,]


ACC.all<-ACC.all[ACC.all$TrialType == "Training",]

ACC.all$TrialType<-factor(ACC.all$TrialType)
ACC.analysis2<-ddply(ACC.all,.(Subject,TargetType),summarise,ACC=mean(ACC))

#Print table of means
ACC.table <- ddply(ACC.analysis2, c("TargetType"), summarise,
               N    = length(ACC),
               mean = mean(ACC),
               sd   = sd(ACC),
               se   = sd / sqrt(N)
               )
kable(xtable(ACC.table),type="html")

limits <- aes(ymax = mean + se, ymin = mean - se)
Exp2.ACC.plot<-ggplot(ACC.table,aes(x=TargetType, y=mean,fill=TargetType))+
  geom_bar(stat="identity", position=position_dodge(width=.9)) + 
  geom_errorbar(limits, width = .2, position=position_dodge(width=.9))+
  #scale_fill_manual(values=c("tomato2", "dodgerblue2", "seagreen4"))+
  scale_fill_manual(values=c("#56B4E9", "#009E73"))+
  coord_cartesian(ylim = c(0, 1))+
  theme_classic(base_size=20)+
  labs(title="Exp. 2")+
  ylab("Accuracy (%)")+
  xlab("Proportion")+
  theme(legend.position="top",legend.direction="horizontal",legend.title = element_blank())
Exp2.ACC.plot

ACC.analysis2$Subject<-factor(ACC.analysis2$Subject)
aov.out<-aov(ACC~TargetType + Error(Subject/(TargetType)),ACC.analysis2)
Exp2.ACC.table<-kable(xtable(aov.out),type="html")
Exp2.ACC.table

aov.out<-aov_car(ACC ~ TargetType + Error(Subject/(TargetType)), 
        data = ACC.analysis2)

nice(aov.out, es = "pes", observed = NULL,
    correction = c("none"), MSE = TRUE,
    sig.symbols = c(" +", " *", " **", " ***"))

#### Compare Training to Mixed Blocks ######
ACC.all<-AllDatanew[AllDatanew$Subject%in%CorruptedData==FALSE,]
ACC.all<-ACC.all[ACC.all$TrialType == "Training",]
ACC.all$TrialType<-factor(ACC.all$TrialType)
ACC.analysis2<-ddply(ACC.all,.(Subject,TrialType,TargetType),summarise,ACC=mean(ACC))
ACC.analysis2$Phase<-"Training"

ACC.all<-AllDatanew[AllDatanew$Subject%in%CorruptedData==FALSE,]
ACC.all<-ACC.all[ACC.all$TrialType != "Training",]
ACC.all$TrialType<-factor(ACC.all$TrialType)
ACC.analysis1<-ddply(ACC.all,.(Subject,TrialType,TargetType),summarise,ACC=mean(ACC))
ACC.analysis1$Phase<-"Mixed"

ACC.analysis3<-rbind(ACC.analysis1,ACC.analysis2)
ACC.analysis3$Phase<-factor(ACC.analysis3$Phase)

ACC.new<-ddply(ACC.analysis3,.(Subject,Phase),summarise,ACC=mean(ACC))


ACC.table <- ddply(ACC.new, c("Phase"), summarise,
               N    = length(ACC),
               mean = mean(ACC),
               sd   = sd(ACC),
               se   = sd / sqrt(N)
               )
kable(xtable(ACC.table),type="html")

limits <- aes(ymax = mean + se, ymin = mean - se)
Exp2.ACC.plot<-ggplot(ACC.table,aes(x=Phase, y=mean,fill=Phase))+
  geom_bar(stat="identity", position=position_dodge(width=.9)) + 
  geom_errorbar(limits, width = .2, position=position_dodge(width=.9))+
  #scale_fill_manual(values=c("tomato2", "dodgerblue2", "seagreen4"))+
  scale_fill_manual(values=c("#56B4E9", "#009E73"))+
  coord_cartesian(ylim = c(0, 1))+
  theme_classic(base_size=20)+
  labs(title="Exp. 2")+
  ylab("Accuracy (%)")+
  xlab("Proportion")+
  theme(legend.position="top",legend.direction="horizontal",legend.title = element_blank())
Exp2.ACC.plot


ACC.new$Subject<-factor(ACC.new$Subject)
aov.out<-aov(ACC~Phase + Error(Subject/(Phase)),ACC.new)
Exp2.ACC.table<-kable(xtable(aov.out),type="html")
Exp2.ACC.table
```

#Exp. 2
# RT Analysis
## TargetType X Proportion: 75/25P Trials

```{r}


RT.p75<-c()
RT.p75<-AllDatanew[AllDatanew$Subject%in%CorruptedData==FALSE,]
RT.p75<-RT.p75[RT.p75$ACC==1,]
RT.p75<-RT.p75[RT.p75$TrialType != "Training",]

#Print table of means
RT.analysis<-ddply(RT.p75,.(Subject,TrialType,TargetType),summarise,RTs=mean(vjout(RTs)$data))
Exp1.tables <- ddply(RT.analysis, c("TrialType","TargetType"), summarise,
               N    = length(RTs),
               mean = mean(RTs),
               sd   = sd(RTs),
               se   = sd / sqrt(N)
               )
kable(xtable(Exp1.tables),type="html")

#ANOVA Proportion x TargetType
RT.analysis<-ddply(RT.p75,.(Subject,TrialType,TargetType),summarise,RTs=mean(vjout(RTs)$data))
RT.analysis$Subject<-factor(RT.analysis$Subject)
aov.out<-aov(RTs~TrialType*TargetType + Error(Subject/(TrialType*TargetType)),RT.analysis)
Exp1.RT75.table<-kable(xtable(aov.out),type="html")
Exp1.RT75.table

#print(summary(aov.out),digits=10)
#print(model.tables(aov.out,"means"),format="markdown")


#Plot Proportion X TargetType
limits <- aes(ymax = mean + se, ymin = mean - se)
Exp1.RT75.plot<-ggplot(Exp1.tables,aes(x=TrialType, y=mean,fill=TargetType))+
  geom_bar(stat="identity", position=position_dodge(width=0.9)) + 
  scale_fill_manual(values=c("#56B4E9", "#009E73"))+
  geom_errorbar(limits, width = .2, position=position_dodge(width=0.9))+
  coord_cartesian(ylim = c(1400,1900 ))+
  theme_classic(base_size=20)+
  labs(title="")+
  ylab("RT")+
  xlab("Proportion")+
  theme(legend.position="top",legend.direction="horizontal",legend.title = element_blank())

Exp1.RT75.plot

#Using Proportion as the grouping variable

RT.analysis<-ddply(RT.p75,.(Subject,Proportion,TargetType),summarise,RTs=mean(vjout(RTs)$data))
Exp1.tables <- ddply(RT.analysis, c("TargetType","Proportion"), summarise,
               N    = length(RTs),
               mean = mean(RTs),
               sd   = sd(RTs),
               se   = sd / sqrt(N)
               )
kable(xtable(Exp1.tables),type="html")



#ANOVA Proportion x TargetType
RT.analysis<-ddply(RT.p75,.(Subject,Proportion,TargetType),summarise,RTs=mean(vjout(RTs)$data))
RT.analysis$Subject<-factor(RT.analysis$Subject)
aov.out<-aov(RTs~Proportion*TargetType + Error(Subject/(Proportion*TargetType)),RT.analysis)
Exp1.RT75.table<-kable(xtable(aov.out),type="html")
Exp1.RT75.table
#print(summary(aov.out),digits=10)
#print(model.tables(aov.out,"means"),format="markdown")


#Plot Proportion X TargetType
limits <- aes(ymax = mean + se, ymin = mean - se)
Exp1.RT75.plot<-ggplot(Exp1.tables,aes(x=TargetType, y=mean,fill=Proportion))+
  geom_bar(stat="identity", position=position_dodge(width=0.9)) + 
  scale_fill_manual(values=c("#56B4E9", "#009E73"))+
  geom_errorbar(limits, width = .2, position=position_dodge(width=0.9))+
  coord_cartesian(ylim = c(1000,1900 ))+
  theme_classic(base_size=20)+
  labs(title="")+
  ylab("RT")+
  xlab("Proportion")+
  theme(legend.position="top",legend.direction="horizontal",legend.title = element_blank())

Exp1.RT75.plot

#Run pairwise t-tests with Holm correction

RT.1<-RT.analysis[RT.analysis$TargetType=="Let",]
print(with(RT.1, pairwise.t.test(RTs,Proportion, paired=T)))

RT.1<-RT.analysis[RT.analysis$TargetType=="Col",]
print(with(RT.1, pairwise.t.test(RTs,Proportion, paired=T)))

```



<a name="exp3"></a>



## Shortcuts:

## [Exp. 1](#exp1)

## [Exp. 2](#exp2)

## [Exp. 3](#exp3)

## [Exp. 4](#exp4)


Dimensional Memory V3
========================================================

Participants were presented with four letters superimposed on four color squares. The location of the colors and letters were randomized from trial-to-trial; each letter and color placed in one of four horizontal positions. Trial stimuli was either presented above or below the fixation point (50% prob.)

After stimulus presentation participants were either asked to report a letter at a particular location, or a color (task).

For example: what was the the letter in the third position?

Participants were instructed to perform one task in each labelled location (for example, upper = color / lower = letter)

Trials were split into 4 blocks: 1 & 2 were training, 3 & 4 were mixed trials

Training: only one task type in it's high proportion location

 Mixed Trials: All trials mixed together. Each location (upper/lower) was associated with a higher probability of a certain task. 
high proportion: 75%

 480 Trials total.

Results: 

 Accuracy and response time was significantly better for color trials 
 
Context-dependent proportion effects were found for both ACC and RT

Significant task switch effects and marginal location switch effects (p=.12). Possible interactions for the 75P and 25P trials

## Read data into dataframe

```{r}
setwd("~/Dropbox/Research/Projects/2015\ DimensionalMemory/Experimentfiles/DimensionalMemory\ V3/data")

subject_data<-c()
subject_data <- list.files(pattern=".*txt")

AllData<-data.frame()
single_sub<-c()
input<-c()
data_info<-c()
alldata_info<-c()

for (i in seq(1:length(subject_data))){
  
  input<-scan(file=subject_data[i], what = "character",skip=(0))
  print(length(input))

    datatable<-matrix(input,ncol=13,byrow=T)
    Subject<-c(rep(i,nrow(datatable)))
    
    data_info<-c(subject_data[i],length(input),nrow(datatable))  
  
    Proportion<-c(datatable[,10])
    TrialType<-c()
    TargetType<-c(datatable[,7])
    TargetPosition<-c(datatable[,9])
    RTs<-c(as.numeric(datatable[,12])-as.numeric(datatable[,11]))
   
#separate letter targets
    Letters<-c(unlist(strsplit(datatable[,1],"")))
    LettersM<-matrix(Letters,ncol=4,byrow=T)

#record responses to match targets
    Response<-recode(datatable[,13],"c('a','A')= 'a';c('s','S')='e';c('d','D')='o';c('f','F')='c';c('h','H')='r';c('j','J')='b';c('k','K')='g';c('l','L')='y'")
   
#number of trials
  Trial<-c(seq(1:nrow(datatable)))

#recode color words to single letters
    ColorP1<-recode(datatable[,2],"'red'= 'r';'blue'='b';'green'='g';'yellow'='y'")
    ColorP2<-recode(datatable[,3],"'red'= 'r';'blue'='b';'green'='g';'yellow'='y'")
    ColorP3<-recode(datatable[,4],"'red'= 'r';'blue'='b';'green'='g';'yellow'='y'")
    ColorP4<-recode(datatable[,5],"'red'= 'r';'blue'='b';'green'='g';'yellow'='y'")
    ColorsM<-cbind(ColorP1,ColorP2,ColorP3,ColorP4)

 P75Recode<-c(datatable[1,6],datatable[1,7],datatable[129,6],datatable[129,7])
#recode the location / proportion label

for (n in (1:nrow(datatable))){
  if (datatable[n,6]==P75Recode[1]){
  TrialType[n]<-paste("high",P75Recode[2])
  }
  if (datatable[n,6]==P75Recode[3]){
    TrialType[n]<-paste("high",P75Recode[4])
  }
}

for (n in (1:nrow(datatable))){
  if (datatable[n,10]=="100P"){
    TrialType[n]<-"Training"
  }
}

#Recode proper proportion labels
for (n in seq(1:nrow(datatable))){
  if (datatable[n,7]==P75Recode[2] && datatable[n,6]==P75Recode[3]){
    Proportion[n]<-c("25P")

    }else{
      if (datatable[n,7]==P75Recode[4] && datatable[n,6]==P75Recode[1]){
    Proportion[n]<-c("25P")

    }
    }
}

#code the accuracy 
ACC<-c()
for (i in seq(1:nrow(datatable))){
  for (n in seq(1:4)){
  if (TargetType[i]=="letter" && TargetPosition[i]==n){
    if (Response[i]==LettersM[i,n]){
      ACC[i]<-1
      }else
        {ACC[i]<-0}
      } 
    }
  for (n in seq(1:4)){
  if (TargetType[i]=="color" && TargetPosition[i]==n){
    if (Response[i]==ColorsM[i,n]){
      ACC[i]<-1
      }else
        {ACC[i]<-0}
      } 
    }
  }


task.ACC<-c()
for (i in seq(1:nrow(datatable))){
  for (n in seq(1:4)){
  if (TargetType[i]=="letter"){
    if (Response[i]=="a" | Response[i]=="o" | Response[i]=="e" | Response[i]=="c"){
      task.ACC[i]<-1
      }else
        {task.ACC[i]<-0}
      } 
    }
  for (n in seq(1:4)){
  if (TargetType[i]=="color"){
    if (Response[i]=="r" | Response[i]=="b" | Response[i]=="g" | Response[i]=="y"){
      task.ACC[i]<-1
      }else
        {task.ACC[i]<-0}
      } 
    }
  }

  Response2<-recode(datatable[,13],"c('a','A')= 'a';c('s','S')='o';c('d','D')='e';c('f','F')='c';c('h','H')='r';c('j','J')='g';c('k','K')='b';c('l','L')='y'")  
#number of trials

c.response<-c()
ACC2<-c()
for (i in seq(1:nrow(datatable))){
  for (n in seq(1:4)){
  if (TargetType[i]=="letter" && TargetPosition[i]==n){
    c.response[i]<-LettersM[i,n]
    if (Response2[i]==LettersM[i,n]){
      ACC2[i]<-1
      }else
        {ACC2[i]<-0}
      } 
    }
  for (n in seq(1:4)){
  if (TargetType[i]=="color" && TargetPosition[i]==n){
     c.response[i]<-ColorsM[i,n]
    if (Response2[i]==ColorsM[i,n]){
      ACC2[i]<-1
      }else
        {ACC2[i]<-0}
      } 
    }
  }

#code change and repeat trials
Task.switch<-c("First")
Loc.switch<-c("First")

for (n in seq((nrow(datatable)-1))){
  if (datatable[n+1,6]==datatable[n,6]){
    Loc.switch[n+1]<-c("L.Repeat")
    }else{
      Loc.switch[n+1]<-c("L.Change")
    }
  if (datatable[n+1,7]==datatable[n,7]){
    Task.switch[n+1]<-c("T.Repeat")
    }else{
      Task.switch[n+1]<-c("T.Change")
    }
  }

Task.switch[257]<-c("First")
Loc.switch[257]<-c("First")
block<-c(rep("T",256),rep("1",128),rep("2",128))
    single_sub<-data.frame(Subject,TrialType,TargetPosition,Proportion,RTs,ACC,Task.switch,Loc.switch,TargetType,ACC2,c.response,task.ACC,block)
    AllData<-rbind(AllData,single_sub)
    alldata_info<-rbind(alldata_info,data_info)
  }

AllData$Subject<-factor(AllData$Subject)

#check<-ddply(AllData,.(Subject,c.response),summarise,ACC=mean(ACC),ACC2=mean(ACC2))
#check<-check[check$c.response=="b" | check$c.response=="g",]
#check

#check<-ddply(AllData,.(Subject,c.response),summarise,ACC=mean(ACC),ACC2=mean(ACC2))
#check<-check[check$c.response=="o" | check$c.response=="e",]
#check

#print(alldata_info)
```


#Compare Task ACC
```{r}

Task.ACC<-ddply(AllData,.(Subject,TrialType,TargetType),summarise,ACC=mean(task.ACC))

ggplot(Task.ACC,aes(x=Subject, y=ACC,color=TargetType))+
  geom_point(size=3)+
  theme_classic(base_size=15)+
  ylab("Proportion Correct")+
  xlab("Subject")+
  ylim(0,1)+
  theme(legend.position="top",
    legend.direction="horizontal",
    legend.title = element_blank())+
  facet_wrap(~TrialType)

Task.ACC<-Task.ACC[(order(Task.ACC$ACC)),]
kable(Task.ACC,format="markdown")



```


#Exp. 3
#Basic Analysis of All Trials

Some basic checks on the data to identify subjects that have completed the task properly

```{r}


AllData$Subject<-factor(AllData$Subject)
# 0-10% Task ACC
AllData<-AllData[AllData$Subject!=1,]
AllData<-AllData[AllData$Subject!=4,]
AllData<-AllData[AllData$Subject!=13,]
#AllDatanew<-AllDatanew[AllDatanew$Subject!=20,]
AllDatanew<-AllData

#40-50% Task ACC
#AllDatanew<-AllDatanew[AllDatanew$Subject!=15,]
#AllDatanew<-AllDatanew[AllDatanew$RTs>100,]
#AllDatanew<-AllDatanew[AllDatanew$RTs<5000,]

ExploreDF<-ddply(AllDatanew,.(Subject,TrialType,TargetType),summarise,meanRT=mean(RTs),meanAccuracy=mean(ACC),TrialsCompleted=length(RTs),maxRT=max(RTs),vjoutRT=mean(vjout(RTs)$data),removed=vjout(RTs)$pr)
CorruptedData<-ExploreDF[ExploreDF$meanRT<0,]$Subject
CorruptedData

CleanDF<-ExploreDF[ExploreDF$Subject%in%CorruptedData==FALSE,]

ggplot(CleanDF,aes(x=vjoutRT, y=meanAccuracy,color=TrialType))+
  geom_point()+
  theme_classic(base_size=15)+
  ylab("Proportion Correct")+
  xlab("Mean Reaction Time (ms")+
  ylim(0,1)+
  theme(legend.position="top",
    legend.direction="horizontal",
    legend.title = element_blank())

kable(CleanDF,format="markdown")

#min ACC
print(min(CleanDF$meanAccuracy))
print(max(CleanDF$maxRT))


```


# Exp. 3
# Accuracy Analysis
## TargetType X TrialType: as 2-level factor (excluding 100/training)

```{r}


ACC.all<-c()
ACC.all<-AllData[AllData$Subject%in%CorruptedData==FALSE,]
ACC.all<-ACC.all[ACC.all$TrialType!="Training",]
ACC.all$TrialType<-factor(ACC.all$TrialType)
#ACC.all<-ACC.all[ACC.all$task.ACC==1,]
#ACC.p100<-AllDatanew


ACC.analysis<-ddply(ACC.all,.(Subject,TrialType,TargetType),summarise,ACC=mean(ACC))
ACC.analysis1$Phase<-"Training"

#Print table of means
Exp3.tables <- ddply(ACC.analysis, c("TrialType","TargetType"), summarise,
               N    = length(ACC),
               mean = mean(ACC),
               sd   = sd(ACC),
               se   = sd / sqrt(N)
               )
kable(xtable(Exp3.tables),type="html")

#print(summary(aov.out),digits=10)
#print(model.tables(aov.out,"means"),format="markdown")

#Analysis without training
ACC.analysis$Subject<-factor(ACC.analysis$Subject)
ACC.analysis1<-ACC.analysis[ACC.analysis$TrialType!="Training",]
aov.out<-aov(ACC~TrialType*TargetType + Error(Subject/(TrialType*TargetType)),ACC.analysis1)
Exp3.ACC.table<-kable(xtable(aov.out),type="html")
Exp3.ACC.table


aov.out<-aov_car(ACC ~ TrialType*TargetType + Error(Subject/(TrialType*TargetType)), 
        data = ACC.analysis)

nice(aov.out, es = "pes", observed = NULL,
    correction = c("none"), MSE = TRUE,
    sig.symbols = c(" +", " *", " **", " ***"))

limits <- aes(ymax = mean + se, ymin = mean - se)
Exp3.ACC.plot<-ggplot(Exp3.tables,aes(x=TrialType, y=mean,fill=TargetType))+
  geom_bar(stat="identity", position=position_dodge(width=.9)) + 
  scale_fill_manual(values=c("#56B4E9", "#009E73"))+
  geom_errorbar(limits, width = .2, position=position_dodge(width=.9))+
  coord_cartesian(ylim = c(0, 1))+
  theme_classic(base_size=15)+
  labs(title="Exp. 3")+
  ylab("Accuracy (%)")+
  xlab("Proportion")+
  theme(legend.position="top",legend.direction="horizontal")
Exp3.ACC.plot

ACC.all<-c()
ACC.all<-AllData[AllData$Subject%in%CorruptedData==FALSE,]
ACC.all<-ACC.all[ACC.all$TrialType!="Training",]
ACC.all$TrialType<-factor(ACC.all$TrialType)
#ACC.all<-ACC.all[ACC.all$task.ACC==1,]
#ACC.p100<-AllDatanew


### USING PROPORTION AS GROUPING VARIABLE ###

ACC.analysis<-ddply(ACC.all,.(Subject,Proportion,TargetType),summarise,ACC=mean(ACC))
ACC.analysis1$Phase<-"Training"

#Print table of means
Exp3.tables <- ddply(ACC.analysis, c("TargetType","Proportion"), summarise,
               N    = length(ACC),
               mean = mean(ACC),
               sd   = sd(ACC),
               se   = sd / sqrt(N)
               )
kable(xtable(Exp3.tables),type="html")

#print(summary(aov.out),digits=10)
#print(model.tables(aov.out,"means"),format="markdown")

#Analysis without training
ACC.analysis$Subject<-factor(ACC.analysis$Subject)
ACC.analysis1<-ACC.analysis[ACC.analysis$Proportion!="Training",]
aov.out<-aov(ACC~Proportion*TargetType + Error(Subject/(Proportion*TargetType)),ACC.analysis1)
Exp3.ACC.table<-kable(xtable(aov.out),type="html")
Exp3.ACC.table


aov.out<-aov_car(ACC ~ Proportion*TargetType + Error(Subject/(Proportion*TargetType)), 
        data = ACC.analysis)

nice(aov.out, es = "pes", observed = NULL,
    correction = c("none"), MSE = TRUE,
    sig.symbols = c(" +", " *", " **", " ***"))

limits <- aes(ymax = mean + se, ymin = mean - se)
Exp3.ACC.plot<-ggplot(Exp3.tables,aes(x=TargetType, y=mean,fill=Proportion))+
  geom_bar(stat="identity", position=position_dodge(width=.9)) + 
  scale_fill_manual(values=c("#56B4E9", "#009E73"))+
  geom_errorbar(limits, width = .2, position=position_dodge(width=.9))+
  coord_cartesian(ylim = c(0, 1))+
  theme_classic(base_size=15)+
  labs(title="Exp. 3")+
  ylab("Accuracy (%)")+
  xlab("Proportion")+
  theme(legend.position="top",legend.direction="horizontal")
Exp3.ACC.plot
```

## TABLE WITH TRAINING INCLUDED
```{r}
ACC.all<-c()
ACC.all<-AllDatanew[AllDatanew$Subject%in%CorruptedData==FALSE,]
ACC.all<-ACC.all[ACC.all$TrialType=="Training",]
ACC.all$TrialType<-factor(ACC.all$TrialType)

ACC.all$TrialType<-factor(ACC.all$TrialType)
ACC.analysis<-ddply(ACC.all,.(Subject,TargetType),summarise,ACC=mean(ACC))

#Print table of means
ACC.table <- ddply(ACC.analysis, c("TargetType"), summarise,
               N    = length(ACC),
               mean = mean(ACC),
               sd   = sd(ACC),
               se   = sd / sqrt(N)
               )
kable(xtable(ACC.table),type="html")

limits <- aes(ymax = mean + se, ymin = mean - se)
Exp2.ACC.plot<-ggplot(ACC.table,aes(x=TargetType, y=mean,fill=TargetType))+
  geom_bar(stat="identity", position=position_dodge(width=.9)) + 
  geom_errorbar(limits, width = .2, position=position_dodge(width=.9))+
  #scale_fill_manual(values=c("tomato2", "dodgerblue2", "seagreen4"))+
  scale_fill_manual(values=c("#56B4E9", "#009E73"))+
  coord_cartesian(ylim = c(0, 1))+
  theme_classic(base_size=20)+
  labs(title="Exp. 3 Training")+
  ylab("Accuracy (%)")+
  xlab("Proportion")+
  theme(legend.position="top",legend.direction="horizontal",legend.title = element_blank())
Exp2.ACC.plot


ACC.all<-c()
ACC.all<-AllDatanew[AllDatanew$Subject%in%CorruptedData==FALSE,]
ACC.all<-ACC.all[ACC.all$TrialType=="Training",]
ACC.all$TrialType<-factor(ACC.all$TrialType)
ACC.analysis<-ddply(ACC.all,.(Subject,TargetType),summarise,ACC=mean(ACC))
aov.out<-aov(ACC~TargetType + Error(Subject/(TargetType)),ACC.analysis)
Exp3.ACC.table<-kable(xtable(aov.out),type="html")
Exp3.ACC.table


aov.out<-aov_car(ACC ~ TargetType + Error(Subject/(TargetType)), 
        data = ACC.analysis)

nice(aov.out, es = "pes", observed = NULL,
    correction = c("none"), MSE = TRUE,
    sig.symbols = c(" +", " *", " **", " ***"))

ACC.all<-c()
ACC.all<-AllDatanew[AllDatanew$Subject%in%CorruptedData==FALSE,]
ACC.all<-ACC.all[ACC.all$TrialType == "Training",]
ACC.all$TrialType<-factor(ACC.all$TrialType)
ACC.analysis2<-ddply(ACC.all,.(Subject,TrialType,TargetType),summarise,ACC=mean(ACC))
ACC.analysis2$Phase<-"Training"
ACC.all<-c()
ACC.all<-AllDatanew[AllDatanew$Subject%in%CorruptedData==FALSE,]
ACC.all<-ACC.all[ACC.all$TrialType != "Training",]
ACC.all$TrialType<-factor(ACC.all$TrialType)
ACC.analysis1<-ddply(ACC.all,.(Subject,TrialType,TargetType),summarise,ACC=mean(ACC))
ACC.analysis1$Phase<-"Mixed"

ACC.analysis3<-rbind(ACC.analysis1,ACC.analysis2)
ACC.analysis3$Phase<-factor(ACC.analysis3$Phase)

ACC.new<-ddply(ACC.analysis3,.(Subject,Phase),summarise,ACC=mean(ACC))


ACC.table <- ddply(ACC.new, c("Phase"), summarise,
               N    = length(ACC),
               mean = mean(ACC),
               sd   = sd(ACC),
               se   = sd / sqrt(N)
               )
kable(xtable(ACC.table),type="html")

limits <- aes(ymax = mean + se, ymin = mean - se)
Exp2.ACC.plot<-ggplot(ACC.table,aes(x=Phase, y=mean,fill=Phase))+
  geom_bar(stat="identity", position=position_dodge(width=.9)) + 
  geom_errorbar(limits, width = .2, position=position_dodge(width=.9))+
  #scale_fill_manual(values=c("tomato2", "dodgerblue2", "seagreen4"))+
  scale_fill_manual(values=c("#56B4E9", "#009E73"))+
  coord_cartesian(ylim = c(0, 1))+
  theme_classic(base_size=20)+
  labs(title="Exp. 3")+
  ylab("Accuracy (%)")+
  xlab("Proportion")+
  theme(legend.position="top",legend.direction="horizontal",legend.title = element_blank())
Exp2.ACC.plot


ACC.new$Subject<-factor(ACC.new$Subject)
aov.out<-aov(ACC~Phase + Error(Subject/(Phase)),ACC.new)
Exp2.ACC.table<-kable(xtable(aov.out),type="html")
Exp2.ACC.table

```

#Exp. 3
# RT Analysis
## TargetType X Proportion: 75/25P Trials

```{r}


RT.p75<-c()
RT.p75<-AllDatanew[AllDatanew$Subject%in%CorruptedData==FALSE,]
RT.p75<-RT.p75[RT.p75$ACC==1,]
RT.p75<-RT.p75[RT.p75$TrialType != "Training",]

#Print table of means
RT.analysis<-ddply(RT.p75,.(Subject,TrialType,TargetType),summarise,RTs=mean(vjout(RTs)$data))
Exp1.tables <- ddply(RT.analysis, c("TrialType","TargetType"), summarise,
               N    = length(RTs),
               mean = mean(RTs),
               sd   = sd(RTs),
               se   = sd / sqrt(N)
               )
kable(xtable(Exp1.tables),type="html")

#ANOVA Proportion x TargetType
RT.analysis<-ddply(RT.p75,.(Subject,TrialType,TargetType),summarise,RTs=mean(vjout(RTs)$data))
RT.analysis$Subject<-factor(RT.analysis$Subject)
aov.out<-aov(RTs~TrialType*TargetType + Error(Subject/(TrialType*TargetType)),RT.analysis)
Exp1.RT75.table<-kable(xtable(aov.out),type="html")
Exp1.RT75.table

#print(summary(aov.out),digits=10)
#print(model.tables(aov.out,"means"),format="markdown")


#Plot Proportion X TargetType
limits <- aes(ymax = mean + se, ymin = mean - se)
Exp1.RT75.plot<-ggplot(Exp1.tables,aes(x=TrialType, y=mean,fill=TargetType))+
  geom_bar(stat="identity", position=position_dodge(width=0.9)) + 
  scale_fill_manual(values=c("#56B4E9", "#009E73"))+
  geom_errorbar(limits, width = .2, position=position_dodge(width=0.9))+
  coord_cartesian(ylim = c(1500,2000 ))+
  theme_classic(base_size=20)+
  labs(title="")+
  ylab("RT")+
  xlab("Proportion")+
  theme(legend.position="top",legend.direction="horizontal",legend.title = element_blank())

Exp1.RT75.plot

#Using Proportion as the grouping variable

RT.analysis<-ddply(RT.p75,.(Subject,Proportion,TargetType),summarise,RTs=mean(vjout(RTs)$data))
Exp1.tables <- ddply(RT.analysis, c("TargetType","Proportion"), summarise,
               N    = length(RTs),
               mean = mean(RTs),
               sd   = sd(RTs),
               se   = sd / sqrt(N)
               )
kable(xtable(Exp1.tables),type="html")



#ANOVA Proportion x TargetType
RT.analysis<-ddply(RT.p75,.(Subject,Proportion,TargetType),summarise,RTs=mean(vjout(RTs)$data))
RT.analysis$Subject<-factor(RT.analysis$Subject)
aov.out<-aov(RTs~Proportion*TargetType + Error(Subject/(Proportion*TargetType)),RT.analysis)
Exp1.RT75.table<-kable(xtable(aov.out),type="html")
Exp1.RT75.table
#print(summary(aov.out),digits=10)
#print(model.tables(aov.out,"means"),format="markdown")


#Plot Proportion X TargetType
limits <- aes(ymax = mean + se, ymin = mean - se)
Exp1.RT75.plot<-ggplot(Exp1.tables,aes(x=TargetType, y=mean,fill=Proportion))+
  geom_bar(stat="identity", position=position_dodge(width=0.9)) + 
  scale_fill_manual(values=c("#56B4E9", "#009E73"))+
  geom_errorbar(limits, width = .2, position=position_dodge(width=0.9))+
  coord_cartesian(ylim = c(1400,1900 ))+
  theme_classic(base_size=20)+
  labs(title="")+
  ylab("RT")+
  xlab("Proportion")+
  theme(legend.position="top",legend.direction="horizontal",legend.title = element_blank())

Exp1.RT75.plot

#Run pairwise t-tests with Holm correction

RT.1<-RT.analysis[RT.analysis$TargetType=="letter",]
print(with(RT.1, pairwise.t.test(RTs,Proportion, paired=T)))

RT.1<-RT.analysis[RT.analysis$TargetType=="color",]
print(with(RT.1, pairwise.t.test(RTs,Proportion, paired=T)))

```




<a name="exp4"></a>

## Shortcuts:

## [Exp. 1](#exp1)

## [Exp. 2](#exp2)

## [Exp. 3](#exp3)

## [Exp. 4](#exp4)



Dimensional Memory V4
========================================================

Participants were presented with four letters superimposed on four color squares. The location of the colors and letters were randomized from trial-to-trial; each letter and color placed in one of four horizontal positions. Trial stimuli was either presented above or below the fixation point (50% prob.)

After stimulus presentation participants were either asked to report a letter at a particular location, or a color (task).

For example: what was the the letter in the third position?

Participants were instructed to perform one task in each labelled location (for example, upper = color / lower = letter)

Trials were split into 4 blocks: 1 & 2 were training, 3 & 4 were mixed trials

Training: only one task type in it's high proportion location

 Mixed Trials: All trials mixed together. Each location (upper/lower) was associated with a higher probability of a certain task. 
high proportion: 75%

 480 Trials total.

Results: 

 Accuracy and response time was significantly better for color trials 
 
Context-dependent proportion effects were found for both ACC and RT

Significant task switch effects and marginal location switch effects (p=.12). Possible interactions for the 75P and 25P trials

## Read data into dataframe

```{r}
setwd("~/Dropbox/Research/Projects/2015\ DimensionalMemory/Experimentfiles/DimensionalMemory\ V4b/data")

subject_data<-c()
subject_data <- list.files(pattern=".*txt")

AllData<-data.frame()
single_sub<-c()
input<-c()
data_info<-c()
alldata_info<-c()

for (i in seq(1:length(subject_data))){
  
  input<-scan(file=subject_data[i], what = "character",skip=(0))
  print(length(input))

    datatable<-matrix(input,ncol=14,byrow=T)
    Subject<-c(rep(i,nrow(datatable)))
    
    data_info<-c(subject_data[i],length(input),nrow(datatable))  
  
    block.type<-c(datatable[,11])
    Proportion<-c(datatable[,10])
    TrialType<-c(datatable[,8])
    TargetType<-c(datatable[,7])
    TargetPosition<-c(datatable[,9])
    RTs<-c(as.numeric(datatable[,13])-as.numeric(datatable[,12]))
   
#separate letter targets
    Letters<-c(unlist(strsplit(datatable[,1],"")))
    LettersM<-matrix(Letters,ncol=4,byrow=T)

#record responses to match targets
    Response<-recode(datatable[,14],"c('a','A')= 'a';c('s','S')='e';c('d','D')='o';c('f','F')='c';c('h','H')='r';c('j','J')='b';c('k','K')='g';c('l','L')='y'")
   
#number of trials
  Trial<-c(seq(1:nrow(datatable)))

#recode color words to single letters
    ColorP1<-recode(datatable[,2],"'red'= 'r';'blue'='b';'green'='g';'yellow'='y'")
    ColorP2<-recode(datatable[,3],"'red'= 'r';'blue'='b';'green'='g';'yellow'='y'")
    ColorP3<-recode(datatable[,4],"'red'= 'r';'blue'='b';'green'='g';'yellow'='y'")
    ColorP4<-recode(datatable[,5],"'red'= 'r';'blue'='b';'green'='g';'yellow'='y'")
    ColorsM<-cbind(ColorP1,ColorP2,ColorP3,ColorP4)

 P75Recode<-c(datatable[1,6],datatable[1,7],datatable[129,6],datatable[129,7])
#recode the location / proportion label

#code the accuracy 
ACC<-c()
for (i in seq(1:nrow(datatable))){
  for (n in seq(1:4)){
  if (TargetType[i]=="letter" && TargetPosition[i]==n){
    if (Response[i]==LettersM[i,n]){
      ACC[i]<-1
      }else
        {ACC[i]<-0}
      } 
    }
  for (n in seq(1:4)){
  if (TargetType[i]=="color" && TargetPosition[i]==n){
    if (Response[i]==ColorsM[i,n]){
      ACC[i]<-1
      }else
        {ACC[i]<-0}
      } 
    }
  }


task.ACC<-c()
for (i in seq(1:nrow(datatable))){
  for (n in seq(1:4)){
  if (TargetType[i]=="letter"){
    if (Response[i]=="a" | Response[i]=="o" | Response[i]=="e" | Response[i]=="c"){
      task.ACC[i]<-1
      }else
        {task.ACC[i]<-0}
      } 
    }
  for (n in seq(1:4)){
  if (TargetType[i]=="color"){
    if (Response[i]=="r" | Response[i]=="b" | Response[i]=="g" | Response[i]=="y"){
      task.ACC[i]<-1
      }else
        {task.ACC[i]<-0}
      } 
    }
  }

  Response2<-recode(datatable[,14],"c('a','A')= 'a';c('s','S')='o';c('d','D')='e';c('f','F')='c';c('h','H')='r';c('j','J')='g';c('k','K')='b';c('l','L')='y'")  
#number of trials

c.response<-c()
ACC2<-c()
for (i in seq(1:nrow(datatable))){
  for (n in seq(1:4)){
  if (TargetType[i]=="letter" && TargetPosition[i]==n){
    c.response[i]<-LettersM[i,n]
    if (Response2[i]==LettersM[i,n]){
      ACC2[i]<-1
      }else
        {ACC2[i]<-0}
      } 
    }
  for (n in seq(1:4)){
  if (TargetType[i]=="color" && TargetPosition[i]==n){
     c.response[i]<-ColorsM[i,n]
    if (Response2[i]==ColorsM[i,n]){
      ACC2[i]<-1
      }else
        {ACC2[i]<-0}
      } 
    }
  }

#code change and repeat trials
Task.switch<-c("First")
Loc.switch<-c("First")

for (n in seq((nrow(datatable)-1))){
  if (datatable[n+1,6]==datatable[n,6]){
    Loc.switch[n+1]<-c("L.Repeat")
    }else{
      Loc.switch[n+1]<-c("L.Change")
    }
  if (datatable[n+1,7]==datatable[n,7]){
    Task.switch[n+1]<-c("T.Repeat")
    }else{
      Task.switch[n+1]<-c("T.Change")
    }
  }

Task.switch[257]<-c("First")
Loc.switch[257]<-c("First")
block<-c(rep("T",96),rep("1",96),rep("1",96),rep("2",96),rep("2",96))
    single_sub<-data.frame(Subject,block,block.type,Proportion,TrialType,TargetPosition,RTs,ACC,Task.switch,Loc.switch,TargetType,ACC2,c.response,task.ACC)
    AllData<-rbind(AllData,single_sub)
    alldata_info<-rbind(alldata_info,data_info)
  }

AllData$Subject<-factor(AllData$Subject)

check<-ddply(AllData,.(Subject,c.response),summarise,ACC=mean(ACC),ACC2=mean(ACC2))
check<-check[check$c.response=="b" | check$c.response=="g",]
check

check<-ddply(AllData,.(Subject,c.response),summarise,ACC=mean(ACC),ACC2=mean(ACC2))
check<-check[check$c.response=="o" | check$c.response=="e",]
check

print(alldata_info)
```


#Compare Task ACC
```{r}

Task.ACC<-ddply(AllData,.(Subject,TrialType,TargetType,block.type),summarise,ACC=mean(task.ACC))
Task.ACC<-Task.ACC[Task.ACC$block!="T",]

ggplot(Task.ACC,aes(x=Subject, y=ACC,color=TargetType))+
  geom_point(size=3)+
  theme_classic(base_size=15)+
  ylab("Proportion Correct")+
  xlab("Subject")+
  ylim(0,1)+
  theme(legend.position="top",
    legend.direction="horizontal",
    legend.title = element_blank())+
  facet_wrap(~TrialType)

Task.ACC<-Task.ACC[(order(Task.ACC$ACC)),]
kable(Task.ACC,format="markdown")



```


#Exp. 4
#Basic Analysis of All Trials

Some basic checks on the data to identify subjects that have completed the task properly

```{r}

AllDatanew<-AllData
AllDatanew$Subject<-factor(AllDatanew$Subject)


# 0% Task ACC

AllDatanew<-AllDatanew[AllDatanew$Subject!=6,]
AllDatanew<-AllDatanew[AllDatanew$Subject!=16,]
AllDatanew<-AllDatanew[AllDatanew$Subject!=23,]

#<10%
AllDatanew<-AllDatanew[AllDatanew$Subject!=26,]

#<25%
AllDatanew<-AllDatanew[AllDatanew$Subject!=3,]
AllDatanew<-AllDatanew[AllDatanew$Subject!=14,]




# <40% Training ACC
#AllDatanew<-AllDatanew[AllDatanew$Subject!=7,]
#AllDatanew<-AllDatanew[AllDatanew$Subject!=12,]
#AllDatanew<-AllDatanew[AllDatanew$RTs>0,]
#AllDatanew<-AllDatanew[AllDatanew$RTs<5000,]
AllDatanew1<-AllDatanew[AllDatanew$block!="T",]

ExploreDF<-ddply(AllDatanew1,.(Subject,block.type,TrialType,TargetType),summarise,meanRT=mean(RTs),meanAccuracy=mean(ACC),TrialsCompleted=length(RTs),maxRT=max(RTs),vjoutRT=mean(vjout(RTs)$data),removed=vjout(RTs)$pr)
CorruptedData<-ExploreDF[ExploreDF$meanRT<0,]$Subject
CorruptedData

CleanDF<-ExploreDF[ExploreDF$Subject%in%CorruptedData==FALSE,]

ggplot(CleanDF,aes(x=vjoutRT, y=meanAccuracy,color=TrialType))+
  geom_point()+
  theme_classic(base_size=15)+
  ylab("Proportion Correct")+
  xlab("Mean Reaction Time (ms")+
  ylim(0,1)+
  theme(legend.position="top",
    legend.direction="horizontal",
    legend.title = element_blank())

kable(CleanDF,format="markdown")

#min ACC
print(min(CleanDF$meanAccuracy))
print(max(CleanDF$maxRT))


AllDatanew2<-AllDatanew[AllDatanew$block=="T",]

ExploreDF<-ddply(AllDatanew2,.(Subject,block,block.type,TrialType,TargetType),summarise,meanRT=mean(RTs),meanAccuracy=mean(ACC),TrialsCompleted=length(RTs),maxRT=max(RTs),vjoutRT=mean(vjout(RTs)$data),removed=vjout(RTs)$pr)
CorruptedData<-ExploreDF[ExploreDF$meanRT<0,]$Subject
CorruptedData

CleanDF<-ExploreDF[ExploreDF$Subject%in%CorruptedData==FALSE,]

ggplot(CleanDF,aes(x=vjoutRT, y=meanAccuracy,color=TrialType))+
  geom_point()+
  theme_classic(base_size=15)+
  ylab("Proportion Correct")+
  xlab("Mean Reaction Time (ms")+
  ylim(0,1)+
  theme(legend.position="top",
    legend.direction="horizontal",
    legend.title = element_blank())

kable(CleanDF,format="markdown")

#min ACC
print(min(CleanDF$meanAccuracy))
print(max(CleanDF$maxRT))

```


# Exp. 4
# Accuracy Analysis


```{r}
ACC.all<-AllDatanew
ACC.all<-ACC.all[ACC.all$block!="T",]
ACC.all$TrialType<-factor(ACC.all$TrialType)
ACC.analysis<-ddply(ACC.all,.(Subject,block.type,TrialType,TargetType),summarise,ACC=mean(ACC),RT=mean(vjout(RTs)$data))

#Print table of means
Exp4.tables <- ddply(ACC.analysis, c("block.type","TrialType","TargetType"), summarise,
               N    = length(ACC),
               mean = mean(ACC),
               sd   = sd(ACC),
               se   = sd / sqrt(N)
               )
kable(xtable(Exp4.tables),type="html")

#ANOVA TrialType X TargetType

aov.out<-aov(ACC~TrialType*TargetType*block.type + Error(Subject/(TrialType*TargetType*block.type)),ACC.analysis)
Exp4.ACC.table<-kable(xtable(aov.out),type="html")
Exp4.ACC.table


aov.out<-aov_car(ACC ~ TrialType*TargetType*block.type + Error(Subject/(TrialType*TargetType*block.type)), 
        data = ACC.analysis)

nice(aov.out, es = "pes", observed = NULL,
    correction = c("none"), MSE = TRUE,
    sig.symbols = c(" +", " *", " **", " ***"))

#print(summary(aov.out),digits=10)
#print(model.tables(aov.out,"means"),format="markdown")


limits <- aes(ymax =mean + se, ymin = mean - se)
Exp4.ACC.plot<-ggplot(Exp4.tables,aes(x=TrialType, y=mean,fill=TargetType))+
  geom_bar(stat="identity", position=position_dodge(width=.9)) + 
  scale_fill_manual(values=c("#56B4E9", "#009E73"))+
  geom_errorbar(limits, width = .2, position=position_dodge(width=.9))+
  coord_cartesian(ylim = c(0, 1))+
  theme_classic(base_size=15)+
  labs(title="Exp. 4")+
  ylab("Accuracy (%)")+
  xlab("Proportion")+
  theme(legend.position="top",legend.direction="horizontal")+
  facet_wrap(~block.type)
Exp4.ACC.plot


### R.Context Only
ACC.all<-AllDatanew
ACC.all<-ACC.all[ACC.all$block!="T",]
ACC.all<-ACC.all[ACC.all$block.type == "R.Context",]
ACC.all$TrialType<-factor(ACC.all$TrialType)
ACC.analysis<-ddply(ACC.all,.(Subject,TrialType,TargetType),summarise,ACC=mean(ACC),RT=mean(vjout(RTs)$data))

#Print table of means
Exp4.tables <- ddply(ACC.analysis, c("TrialType","TargetType"), summarise,
               N    = length(ACC),
               mean = mean(ACC),
               sd   = sd(ACC),
               se   = sd / sqrt(N)
               )
kable(xtable(Exp4.tables),type="html")

#ANOVA TrialType X TargetType

aov.out<-aov(ACC~TrialType*TargetType + Error(Subject/(TrialType*TargetType)),ACC.analysis)
Exp4.ACC.table<-kable(xtable(aov.out),type="html")
Exp4.ACC.table


aov.out<-aov_car(ACC ~ TrialType*TargetType + Error(Subject/(TrialType*TargetType)), 
        data = ACC.analysis)

nice(aov.out, es = "pes", observed = NULL,
    correction = c("none"), MSE = TRUE,
    sig.symbols = c(" +", " *", " **", " ***"))


ACC.1<-ACC.analysis[ACC.analysis$TrialType=="highcolor",]
print(with(ACC.1, pairwise.t.test(ACC,TargetType, paired=T)))

ACC.1<-ACC.analysis[ACC.analysis$TrialType=="highletter",]
print(with(ACC.1, pairwise.t.test(ACC,TargetType, paired=T)))


### T.Context Only
ACC.all<-AllDatanew
ACC.all<-ACC.all[ACC.all$block!="T",]
ACC.all<-ACC.all[ACC.all$block.type == "T.Context",]
ACC.all$TrialType<-factor(ACC.all$TrialType)
ACC.analysis<-ddply(ACC.all,.(Subject,TrialType,TargetType),summarise,ACC=mean(ACC),RT=mean(vjout(RTs)$data))

#Print table of means
Exp4.tables <- ddply(ACC.analysis, c("TrialType","TargetType"), summarise,
               N    = length(ACC),
               mean = mean(ACC),
               sd   = sd(ACC),
               se   = sd / sqrt(N)
               )
kable(xtable(Exp4.tables),type="html")


aov.out<-aov(ACC~TrialType*TargetType + Error(Subject/(TrialType*TargetType)),ACC.analysis)
Exp4.ACC.table<-kable(xtable(aov.out),type="html")
Exp4.ACC.table


aov.out<-aov_car(ACC ~ TrialType*TargetType + Error(Subject/(TrialType*TargetType)), 
        data = ACC.analysis)

nice(aov.out, es = "pes", observed = NULL,
    correction = c("none"), MSE = TRUE,
    sig.symbols = c(" +", " *", " **", " ***"))


ACC.1<-ACC.analysis[ACC.analysis$TrialType=="highcolor",]
print(with(ACC.1, pairwise.t.test(ACC,TargetType, paired=T)))

ACC.1<-ACC.analysis[ACC.analysis$TrialType=="highletter",]
print(with(ACC.1, pairwise.t.test(ACC,TargetType, paired=T)))


```

# Exp. 4
# Accuracy Analysis
## Not removing any subjects due to low task accuracy


```{r}

AllDatanew<-AllData
AllDatanew$Subject<-factor(AllDatanew$Subject)

ACC.all<-c()
ACC.all<-AllDatanew1[AllDatanew1$Subject%in%CorruptedData==FALSE,]
ACC.all<-ACC.all[ACC.all$block!="T",]
ACC.all$TrialType<-factor(ACC.all$TrialType)
ACC.analysis<-ddply(ACC.all,.(Subject,block.type,TrialType,TargetType),summarise,ACC=mean(ACC),RT=mean(vjout(RTs)$data))

#Print table of means
Exp4.tables <- ddply(ACC.analysis, c("block.type","TrialType","TargetType"), summarise,
               N    = length(ACC),
               mean = mean(ACC),
               sd   = sd(ACC),
               se   = sd / sqrt(N)
               )
kable(xtable(Exp4.tables),type="html")

#ANOVA TrialType X TargetType

aov.out<-aov(ACC~TrialType*TargetType*block.type + Error(Subject/(TrialType*TargetType*block.type)),ACC.analysis)
Exp4.ACC.table<-kable(xtable(aov.out),type="html")
Exp4.ACC.table


aov.out<-aov_car(ACC ~ TrialType*TargetType*block.type + Error(Subject/(TrialType*TargetType*block.type)), 
        data = ACC.analysis)

nice(aov.out, es = "pes", observed = NULL,
    correction = c("none"), MSE = TRUE,
    sig.symbols = c(" +", " *", " **", " ***"))

#print(summary(aov.out),digits=10)
#print(model.tables(aov.out,"means"),format="markdown")


limits <- aes(ymax =mean + se, ymin = mean - se)
Exp4.ACC.plot<-ggplot(Exp4.tables,aes(x=TrialType, y=mean,fill=TargetType))+
  geom_bar(stat="identity", position=position_dodge(width=.9)) + 
  scale_fill_manual(values=c("#56B4E9", "#009E73"))+
  geom_errorbar(limits, width = .2, position=position_dodge(width=.9))+
  coord_cartesian(ylim = c(0, 1))+
  theme_classic(base_size=15)+
  labs(title="Exp. 4")+
  ylab("Accuracy (%)")+
  xlab("Proportion")+
  theme(legend.position="top",legend.direction="horizontal")+
  facet_wrap(~block.type)
Exp4.ACC.plot


### R.Context Only
ACC.all<-AllDatanew
ACC.all<-ACC.all[ACC.all$block!="T",]
ACC.all<-ACC.all[ACC.all$block.type == "R.Context",]
ACC.all$TrialType<-factor(ACC.all$TrialType)
ACC.analysis<-ddply(ACC.all,.(Subject,TrialType,TargetType),summarise,ACC=mean(ACC),RT=mean(vjout(RTs)$data))

#Print table of means
Exp4.tables <- ddply(ACC.analysis, c("TrialType","TargetType"), summarise,
               N    = length(ACC),
               mean = mean(ACC),
               sd   = sd(ACC),
               se   = sd / sqrt(N)
               )
kable(xtable(Exp4.tables),type="html")

#ANOVA TrialType X TargetType

aov.out<-aov(ACC~TrialType*TargetType + Error(Subject/(TrialType*TargetType)),ACC.analysis)
Exp4.ACC.table<-kable(xtable(aov.out),type="html")
Exp4.ACC.table


aov.out<-aov_car(ACC ~ TrialType*TargetType + Error(Subject/(TrialType*TargetType)), 
        data = ACC.analysis)

nice(aov.out, es = "pes", observed = NULL,
    correction = c("none"), MSE = TRUE,
    sig.symbols = c(" +", " *", " **", " ***"))


ACC.1<-ACC.analysis[ACC.analysis$TrialType=="highcolor",]
print(with(ACC.1, pairwise.t.test(ACC,TargetType, paired=T)))

ACC.1<-ACC.analysis[ACC.analysis$TrialType=="highletter",]
print(with(ACC.1, pairwise.t.test(ACC,TargetType, paired=T)))


### T.Context Only
ACC.all<-AllDatanew
ACC.all<-ACC.all[ACC.all$block!="T",]
ACC.all<-ACC.all[ACC.all$block.type == "T.Context",]
ACC.all$TrialType<-factor(ACC.all$TrialType)
ACC.analysis<-ddply(ACC.all,.(Subject,TrialType,TargetType),summarise,ACC=mean(ACC),RT=mean(vjout(RTs)$data))

#Print table of means
Exp4.tables <- ddply(ACC.analysis, c("TrialType","TargetType"), summarise,
               N    = length(ACC),
               mean = mean(ACC),
               sd   = sd(ACC),
               se   = sd / sqrt(N)
               )
kable(xtable(Exp4.tables),type="html")


aov.out<-aov(ACC~TrialType*TargetType + Error(Subject/(TrialType*TargetType)),ACC.analysis)
Exp4.ACC.table<-kable(xtable(aov.out),type="html")
Exp4.ACC.table


aov.out<-aov_car(ACC ~ TrialType*TargetType + Error(Subject/(TrialType*TargetType)), 
        data = ACC.analysis)

nice(aov.out, es = "pes", observed = NULL,
    correction = c("none"), MSE = TRUE,
    sig.symbols = c(" +", " *", " **", " ***"))


ACC.1<-ACC.analysis[ACC.analysis$TrialType=="highcolor",]
print(with(ACC.1, pairwise.t.test(ACC,TargetType, paired=T)))

ACC.1<-ACC.analysis[ACC.analysis$TrialType=="highletter",]
print(with(ACC.1, pairwise.t.test(ACC,TargetType, paired=T)))


```


# Exp. 4
# ACC Analysis of location as factor


```{r}


AllDatanew.ACC<-AllDatanew
AllDatanew.ACC<-AllDatanew[AllDatanew.ACC$block != "T",]
set1 <- subset(AllDatanew.ACC,TrialType=="highcolor" & TargetType=="color")
set1$totProp<-"HP_Task"
set2 <- subset(AllDatanew.ACC,TrialType=="highcolor" & TargetType=="letter")
set2$totProp<-"LP_Task"

set3 <- subset(AllDatanew.ACC,TrialType=="highletter" & TargetType=="letter")
set3$totProp<-"HP_Task"
set4 <- subset(AllDatanew.ACC,TrialType=="highletter" & TargetType=="color")
set4$totProp<-"LP_Task"

newData<-rbind(set1,set2,set3,set4)

#Print table of means
ACC.analysis<-ddply(newData,.(Subject,block.type,totProp,TargetType),summarise,ACC=mean(ACC))
Exp1.tables <- ddply(ACC.analysis, c("block.type","TargetType","totProp"), summarise,
               N    = length(ACC),
               mean = mean(ACC),
               sd   = sd(ACC),
               se   = sd / sqrt(N)
               )
kable(xtable(Exp1.tables),type="html")

#ANOVA Proportion x TargetType
ACC.analysis$Subject<-factor(ACC.analysis$Subject)
ACC.analysis$totProp<-factor(ACC.analysis$totProp)
aov.out<-aov(ACC~block.type*totProp*TargetType + Error(Subject/(block.type*totProp*TargetType)),ACC.analysis)
Exp1.ACC75.table<-kable(xtable(aov.out),type="html")
Exp1.ACC75.table

#print(summary(aov.out),digits=10)
#print(model.tables(aov.out,"means"),format="markdown")

limits <- aes(ymax = mean + se, ymin = mean - se)
Exp1.ACC75.plot<-ggplot(Exp1.tables,aes(x=block.type, y=mean,fill=totProp))+
  geom_bar(stat="identity", position=position_dodge(width=0.9)) + 
  scale_fill_manual(values=c("#56B4E9", "#009E73"))+
  geom_errorbar(limits, width = .2, position=position_dodge(width=0.9))+
  coord_cartesian(ylim = c(0, 1))+
  theme_classic(base_size=20)+
  labs(title="")+
  ylab("ACCuracy (%)")+
  xlab("Proportion Location")+
  theme(legend.position="top",legend.direction="horizontal",legend.title = element_blank())+
  facet_wrap(~TargetType)

Exp1.ACC75.plot


## Collapse over Targets (non-sig interaction)

ACC.analysis<-ddply(newData,.(Subject,block.type,totProp),summarise,ACC=mean(ACC))
Exp1.tables <- ddply(ACC.analysis, c("block.type","totProp"), summarise,
               N    = length(ACC),
               mean = mean(ACC),
               sd   = sd(ACC),
               se   = sd / sqrt(N)
               )
kable(xtable(Exp1.tables),type="html")


#Plot Proportion X TargetType
limits <- aes(ymax = mean + se, ymin = mean - se)
Exp1.ACC75.plot<-ggplot(Exp1.tables,aes(x=block.type, y=mean,fill=totProp))+
  geom_bar(stat="identity", position=position_dodge(width=0.9)) + 
  scale_fill_manual(values=c("#56B4E9", "#009E73"))+
  geom_errorbar(limits, width = .2, position=position_dodge(width=0.9))+
  coord_cartesian(ylim = c(0, 1))+
  theme_classic(base_size=20)+
  labs(title="")+
  ylab("ACCuracy (%)")+
  xlab("Proportion Location")+
  theme(legend.position="top",legend.direction="horizontal",legend.title = element_blank())

Exp1.ACC75.plot


#ANOVA block.type x proportion
ACC.analysis$Subject<-factor(ACC.analysis$Subject)
ACC.analysis$totProp<-factor(ACC.analysis$totProp)
aov.out<-aov(ACC~block.type*totProp + Error(Subject/(block.type*totProp)),ACC.analysis)
Exp1.ACC75.table<-kable(xtable(aov.out),type="html")
Exp1.ACC75.table

#Run pairwise t-tests with Holm correction

ACC.1<-ACC.analysis[ACC.analysis$block.type=="R.Context",]
print(with(ACC.1, pairwise.t.test(ACC,totProp, paired=T)))

ACC.1<-ACC.analysis[ACC.analysis$block.type == "T.Context",]
print(with(ACC.1, pairwise.t.test(ACC,totProp, paired=T)))
```


# TABLE WITH TRAINING INCLUDED

```{r}
ACC.all<-c()
ACC.all<-AllDatanew2[AllDatanew2$Subject%in%CorruptedData==FALSE,]
ACC.all$block<-factor(ACC.all$block)

ACC.all$TrialType<-factor(ACC.all$TrialType)
ACC.analysis<-ddply(ACC.all,.(Subject,block,TargetType),summarise,ACC=mean(ACC))

#Print table of means
ACC.table <- ddply(ACC.analysis, c("TargetType"), summarise,
               N    = length(ACC),
               mean = mean(ACC),
               sd   = sd(ACC),
               se   = sd / sqrt(N)
               )
kable(xtable(ACC.table),type="html")

limits <- aes(ymax = mean + se, ymin = mean - se)
Exp2.ACC.plot<-ggplot(ACC.table,aes(x=TargetType, y=mean,fill=TargetType))+
  geom_bar(stat="identity", position=position_dodge(width=.9)) + 
  geom_errorbar(limits, width = .2, position=position_dodge(width=.9))+
  #scale_fill_manual(values=c("tomato2", "dodgerblue2", "seagreen4"))+
  scale_fill_manual(values=c("#56B4E9", "#009E73"))+
  coord_cartesian(ylim = c(0, 1))+
  theme_classic(base_size=20)+
  labs(title="Exp. 3 w/Training")+
  ylab("Accuracy (%)")+
  xlab("Proportion")+
  theme(legend.position="top",legend.direction="horizontal",legend.title = element_blank())
Exp2.ACC.plot


ACC.all<-c()
ACC.all<-AllDatanew2[AllDatanew2$Subject%in%CorruptedData==FALSE,]
ACC.analysis<-ddply(ACC.all,.(Subject,TargetType),summarise,ACC=mean(ACC))
aov.out<-aov(ACC~TargetType + Error(Subject/(TargetType)),ACC.analysis)
Exp3.ACC.table<-kable(xtable(aov.out),type="html")
Exp3.ACC.table

aov.out<-aov_car(ACC ~ TargetType + Error(Subject/(TargetType)), 
        data = ACC.analysis)

nice(aov.out, es = "pes", observed = NULL,
    correction = c("none"), MSE = TRUE,
    sig.symbols = c(" +", " *", " **", " ***"))


ACC.analysis2<-ddply(AllDatanew2,.(Subject,TrialType,TargetType,block.type),summarise,ACC=mean(ACC))
ACC.analysis2$Phase<-"Training"

ACC.analysis1<-ddply(AllDatanew1,.(Subject,TrialType,TargetType,block.type),summarise,ACC=mean(ACC))
ACC.analysisR<-ACC.analysis1[ACC.analysis1$block.type=="R.Context",]
ACC.analysisR$Phase<-"Mixed-R"
ACC.analysisT<-ACC.analysis1[ACC.analysis1$block.type=="T.Context",]
ACC.analysisT$Phase<-"Mixed-T"

ACC.analysis3<-rbind(ACC.analysis2,ACC.analysisR,ACC.analysisT)
ACC.analysis3$Phase<-factor(ACC.analysis3$Phase)

ACC.new<-ddply(ACC.analysis3,.(Subject,Phase),summarise,ACC=mean(ACC))


ACC.table <- ddply(ACC.new, c("Phase"), summarise,
               N    = length(ACC),
               mean = mean(ACC),
               sd   = sd(ACC),
               se   = sd / sqrt(N)
               )
kable(xtable(ACC.table),type="html")

limits <- aes(ymax = mean + se, ymin = mean - se)
Exp2.ACC.plot<-ggplot(ACC.table,aes(x=Phase, y=mean,fill=Phase))+
  geom_bar(stat="identity", position=position_dodge(width=.9)) + 
  geom_errorbar(limits, width = .2, position=position_dodge(width=.9))+
  #scale_fill_manual(values=c("tomato2", "dodgerblue2", "seagreen4"))+
  #scale_fill_manual(values=c("#56B4E9", "#009E73"))+
  coord_cartesian(ylim = c(0, 1))+
  theme_classic(base_size=20)+
  labs(title="Exp. 2")+
  ylab("Accuracy (%)")+
  xlab("Proportion")+
  theme(legend.position="top",legend.direction="horizontal",legend.title = element_blank())
Exp2.ACC.plot


ACC.new$Subject<-factor(ACC.new$Subject)
aov.out<-aov(ACC~Phase + Error(Subject/(Phase)),ACC.new)
Exp2.ACC.table<-kable(xtable(aov.out),type="html")
Exp2.ACC.table



```


```{r}


ACC.all<-c()
ACC.all<-AllDatanew[AllDatanew$Subject%in%CorruptedData==FALSE,]

## Analysis by block.type (collapsed over block)
ACC.analysis<-ACC.all[ACC.all$block!="T",]
ACC.analysis<-ddply(ACC.analysis,.(Subject,block.type,TrialType,TargetType),summarise,ACC=mean(ACC))


ACC.analysis$Subject<-factor(ACC.analysis$Subject)
aov.out<-aov(ACC~block.type*TrialType*TargetType + Error(Subject/(block.type*TrialType*TargetType)),ACC.analysis)
Exp3.ACC.table<-kable(xtable(aov.out),type="html")
Exp3.ACC.table
  

ACC.analysis$Subject<-factor(ACC.analysis$Subject)
ACC.analysis2<-ACC.analysis[ACC.analysis$block.type=="R.Context",]
#ACC.analysis2<-ACC.analysis2[ACC.analysis2$TrialType=="highletter",]
ACC.analysis2$block<-factor(ACC.analysis2$block)
ACC.analysis2$block.type<-factor(ACC.analysis2$block.type)
ACC.analysis2$TrialType<-factor(ACC.analysis2$TrialType)
aov.out<-aov(ACC~TrialType*TargetType + Error(Subject/(TrialType*TargetType)),ACC.analysis2)
Exp3.ACC.table<-kable(xtable(aov.out),type="html")
Exp3.ACC.table


aov.out<-aov_car(ACC ~ TrialType*TargetType + Error(Subject/(TrialType*TargetType)), 
        data = ACC.analysis2)

nice(aov.out, es = "pes", observed = NULL,
    correction = c("none"), MSE = TRUE,
    sig.symbols = c(" +", " *", " **", " ***"))


  ACC.analysis$Subject<-factor(ACC.analysis$Subject)
  ACC.analysis2<-ACC.analysis[ACC.analysis$block.type=="R.Context",]
  ACC.analysis2<-ACC.analysis2[ACC.analysis2$TrialType=="highletter",]
  ACC.analysis2$block<-factor(ACC.analysis2$block)
  ACC.analysis2$block.type<-factor(ACC.analysis2$block.type)
  ACC.analysis2$TrialType<-factor(ACC.analysis2$TrialType)
  aov.out<-aov(ACC~TargetType + Error(Subject/(TargetType)),ACC.analysis2)
  Exp3.ACC.table<-kable(xtable(aov.out),type="html")
  Exp3.ACC.table


aov.out<-aov_car(ACC ~ TargetType + Error(Subject/(TargetType)), 
        data = ACC.analysis2)

nice(aov.out, es = "pes", observed = NULL,
    correction = c("none"), MSE = TRUE,
    sig.symbols = c(" +", " *", " **", " ***"))



  ACC.analysis$Subject<-factor(ACC.analysis$Subject)
  ACC.analysis2<-ACC.analysis[ACC.analysis$block.type=="R.Context",]
  ACC.analysis2<-ACC.analysis2[ACC.analysis2$TrialType=="highcolor",]
  ACC.analysis2$block<-factor(ACC.analysis2$block)
  ACC.analysis2$block.type<-factor(ACC.analysis2$block.type)
  ACC.analysis2$TrialType<-factor(ACC.analysis2$TrialType)
  aov.out<-aov(ACC~TargetType + Error(Subject/(TargetType)),ACC.analysis2)
  Exp3.ACC.table<-kable(xtable(aov.out),type="html")
  Exp3.ACC.table


aov.out<-aov_car(ACC ~ TargetType + Error(Subject/(TargetType)), 
        data = ACC.analysis2)

nice(aov.out, es = "pes", observed = NULL,
    correction = c("none"), MSE = TRUE,
    sig.symbols = c(" +", " *", " **", " ***"))


ACC.analysis$Subject<-factor(ACC.analysis$Subject)
ACC.analysis2<-ACC.analysis[ACC.analysis$block.type=="T.Context",]
#ACC.analysis2<-ACC.analysis2[ACC.analysis2$TrialType=="highletter",]
ACC.analysis2$block<-factor(ACC.analysis2$block)
ACC.analysis2$block.type<-factor(ACC.analysis2$block.type)
ACC.analysis2$TrialType<-factor(ACC.analysis2$TrialType)
aov.out<-aov(ACC~TrialType*TargetType + Error(Subject/(TrialType*TargetType)),ACC.analysis2)
Exp3.ACC.table<-kable(xtable(aov.out),type="html")
Exp3.ACC.table
  
aov.out<-aov_car(ACC ~ TrialType*TargetType + Error(Subject/(TrialType*TargetType)), 
        data = ACC.analysis2)

nice(aov.out, es = "pes", observed = NULL,
    correction = c("none"), MSE = TRUE,
    sig.symbols = c(" +", " *", " **", " ***"))



  ACC.analysis$Subject<-factor(ACC.analysis$Subject)
  ACC.analysis2<-ACC.analysis[ACC.analysis$block.type=="T.Context",]
  ACC.analysis2<-ACC.analysis2[ACC.analysis2$TrialType=="highletter",]
  ACC.analysis2$block<-factor(ACC.analysis2$block)
  ACC.analysis2$block.type<-factor(ACC.analysis2$block.type)
  ACC.analysis2$TrialType<-factor(ACC.analysis2$TrialType)
  aov.out<-aov(ACC~TargetType + Error(Subject/(TargetType)),ACC.analysis2)
  Exp3.ACC.table<-kable(xtable(aov.out),type="html")
  Exp3.ACC.table

aov.out<-aov_car(ACC ~ TargetType + Error(Subject/(TargetType)), 
        data = ACC.analysis2)

nice(aov.out, es = "pes", observed = NULL,
    correction = c("none"), MSE = TRUE,
    sig.symbols = c(" +", " *", " **", " ***"))


  ACC.analysis$Subject<-factor(ACC.analysis$Subject)
  ACC.analysis2<-ACC.analysis[ACC.analysis$block.type=="T.Context",]
  ACC.analysis2<-ACC.analysis2[ACC.analysis2$TrialType=="highcolor",]
  ACC.analysis2$block<-factor(ACC.analysis2$block)
  ACC.analysis2$block.type<-factor(ACC.analysis2$block.type)
  ACC.analysis2$TrialType<-factor(ACC.analysis2$TrialType)
  aov.out<-aov(ACC~TargetType + Error(Subject/(TargetType)),ACC.analysis2)
  Exp3.ACC.table<-kable(xtable(aov.out),type="html")
  Exp3.ACC.table

aov.out<-aov_car(ACC ~ TargetType + Error(Subject/(TargetType)), 
        data = ACC.analysis2)

nice(aov.out, es = "pes", observed = NULL,
    correction = c("none"), MSE = TRUE,
    sig.symbols = c(" +", " *", " **", " ***"))

```

# Exp3 RT Analysis w/ location as the grouping factor
```{r}


AllDatanew.RT<-AllDatanew
AllDatanew.RT<-AllDatanew.RT[AllDatanew.RT$ACC==1,]
AllDatanew.RT<-AllDatanew.RT[AllDatanew.RT$Proportion!= "100P",]
AllDatanew.RT$Proportion<-factor(AllDatanew.RT$Proportion)

set1 <- subset(AllDatanew.RT,TrialType=="highcolor" & TargetType=="color")
set1$totProp<-"HP_Task"
set2 <- subset(AllDatanew.RT,TrialType=="highcolor" & TargetType=="letter")
set2$totProp<-"LP_Task"

set3 <- subset(AllDatanew.RT,TrialType=="highletter" & TargetType=="letter")
set3$totProp<-"HP_Task"
set4 <- subset(AllDatanew.RT,TrialType=="highletter" & TargetType=="color")
set4$totProp<-"LP_Task"

newData<-rbind(set1,set2,set3,set4)


### USING TRIALTYPE AS GROUPING VARIABLE
RT.analysis<-ddply(newData,.(Subject,TrialType,TargetType,block.type),summarise,RT=mean(vjout(RTs)$data))

#RT.analysis<-RT.analysis[RT.analysis$Subject!= 4,]
#RT.analysis<-RT.analysis[RT.analysis$Subject!= 13,]
## IGNORE NA
Exp3.tables <- ddply(RT.analysis, c("block.type","TrialType","TargetType"), summarise,
               N    = length(RT),
               mean = mean(RT,na.rm=TRUE),
               sd   = sd(RT,na.rm=TRUE),
               se   = sd / sqrt(N)
               )
kable(xtable(Exp3.tables),type="html")


RT.analysis<-RT.analysis[RT.analysis$Subject!= 4,]
RT.analysis<-RT.analysis[RT.analysis$Subject!= 13,]
Exp3.tables <- ddply(RT.analysis, c("block.type","TrialType","TargetType"), summarise,
               N    = length(RT),
               mean = mean(RT,na.rm=TRUE),
               sd   = sd(RT,na.rm=TRUE),
               se   = sd / sqrt(N)
               )
kable(xtable(Exp3.tables),type="html")

#ANOVA Proportion x TargetType
RT.analysis$Subject<-factor(RT.analysis$Subject)
aov.out<-aov(RT~block.type*TrialType*TargetType + Error(Subject/(block.type*TrialType*TargetType)),RT.analysis)
Exp3.RT75.table<-kable(xtable(aov.out),type="html")
Exp3.RT75.table

#print(summary(aov.out),digits=10)
#print(model.tables(aov.out,"means"),format="markdown")


#Plot Proportion X TargetType
limits <- aes(ymax = mean + se, ymin = mean - se)
Exp3.RT75.plot<-ggplot(Exp3.tables,aes(x=TrialType, y=mean,fill=TargetType))+
  geom_bar(stat="identity", position=position_dodge(width=0.9)) + 
  scale_fill_manual(values=c("#56B4E9", "#009E73"))+
  geom_errorbar(limits, width = .2, position=position_dodge(width=0.9))+
  #coord_cartesian(ylim = c(0, 1))+
  theme_classic(base_size=20)+
  labs(title="")+
  ylab("RTuracy (%)")+
  xlab("Proportion")+
  theme(legend.position="top",legend.direction="horizontal",legend.title = element_blank())+
  facet_wrap(~block.type)

Exp3.RT75.plot

## Collapse over block type (non-sig interaction)

RT.analysis<-ddply(newData,.(Subject,TrialType,TargetType),summarise,RT=mean(vjout(RTs)$data))

RT.analysis<-RT.analysis[RT.analysis$Subject!= 4,]
RT.analysis<-RT.analysis[RT.analysis$Subject!= 13,]


Exp3.tables <- ddply(RT.analysis, c("TrialType","TargetType"), summarise,
               N    = length(RT),
               mean = mean(RT,na.rm=TRUE),
               sd   = sd(RT,na.rm=TRUE),
               se   = sd / sqrt(N)
               )
kable(xtable(Exp3.tables),type="html")

RT.analysis$Subject<-factor(RT.analysis$Subject)
aov.out<-aov(RT~TrialType*TargetType + Error(Subject/(TrialType*TargetType)),RT.analysis)
Exp3.RT75.table<-kable(xtable(aov.out),type="html")
Exp3.RT75.table

#print(summary(aov.out),digits=10)
#print(model.tables(aov.out,"means"),format="markdown")


limits <- aes(ymax = mean + se, ymin = mean - se)
Exp3.RT75.plot<-ggplot(Exp3.tables,aes(x=TrialType, y=mean,fill=TargetType))+
  geom_bar(stat="identity", position=position_dodge(width=0.9)) + 
  scale_fill_manual(values=c("#56B4E9", "#009E73"))+
  geom_errorbar(limits, width = .2, position=position_dodge(width=0.9))+
  #coord_cartesian(ylim = c(0, 1))+
  theme_classic(base_size=20)+
  labs(title="")+
  ylab("RT")+
  xlab("Proportion")+
  theme(legend.position="top",legend.direction="horizontal",legend.title = element_blank())

Exp3.RT75.plot


### USING LOCATION AS THE GROUPING VARIABLE
#Print table of means
RT.analysis<-ddply(newData,.(Subject,totProp,block.type,TargetType),summarise,RT=mean(vjout(RTs)$data))

RT.analysis<-RT.analysis[RT.analysis$Subject!= 4,]
RT.analysis<-RT.analysis[RT.analysis$Subject!= 13,]
Exp3.tables <- ddply(RT.analysis, c("block.type","totProp","TargetType"), summarise,
               N    = length(RT),
               mean = mean(RT),
               sd   = sd(RT),
               se   = sd / sqrt(N)
               )
kable(xtable(Exp3.tables),type="html")

#ANOVA Proportion x TargetType
RT.analysis$Subject<-factor(RT.analysis$Subject)
RT.analysis$totProp<-factor(RT.analysis$totProp)
aov.out<-aov(RT~totProp*block.type*TargetType + Error(Subject/(totProp*block.type*TargetType)),RT.analysis)
Exp3.RT75.table<-kable(xtable(aov.out),type="html")
Exp3.RT75.table

#print(summary(aov.out),digits=10)
#print(model.tables(aov.out,"means"),format="markdown")


#Plot Proportion X TargetType
limits <- aes(ymax = mean + se, ymin = mean - se)
Exp3.RT75.plot<-ggplot(Exp3.tables,aes(x=block.type, y=mean,fill=totProp))+
  geom_bar(stat="identity", position=position_dodge(width=0.9)) + 
  scale_fill_manual(values=c("#56B4E9", "#009E73"))+
  geom_errorbar(limits, width = .2, position=position_dodge(width=0.9))+
  #coord_cartesian(ylim = c(0, 1))+
  theme_classic(base_size=20)+
  labs(title="")+
  ylab("RTuracy (%)")+
  xlab("Proportion")+
  theme(legend.position="top",legend.direction="horizontal",legend.title = element_blank())+
  facet_wrap(~TargetType)

Exp3.RT75.plot

## Collapse over TargetType
RT.analysis<-ddply(newData,.(Subject,totProp,block.type),summarise,RT=mean(vjout(RTs)$data))

#RT.analysis<-RT.analysis[RT.analysis$Subject!= 4,]
#RT.analysis<-RT.analysis[RT.analysis$Subject!= 13,]
Exp3.tables <- ddply(RT.analysis, c("block.type","totProp"), summarise,
               N    = length(RT),
               mean = mean(RT),
               sd   = sd(RT),
               se   = sd / sqrt(N)
               )
kable(xtable(Exp3.tables),type="html")

#ANOVA Proportion x TargetType
RT.analysis$Subject<-factor(RT.analysis$Subject)
RT.analysis$totProp<-factor(RT.analysis$totProp)
aov.out<-aov(RT~totProp*block.type + Error(Subject/(totProp*block.type)),RT.analysis)
Exp3.RT75.table<-kable(xtable(aov.out),type="html")
Exp3.RT75.table

#print(summary(aov.out),digits=10)
#print(model.tables(aov.out,"means"),format="markdown")


#Plot Proportion X TargetType
limits <- aes(ymax = mean + se, ymin = mean - se)
Exp3.RT75.plot<-ggplot(Exp3.tables,aes(x=block.type, y=mean,fill=totProp))+
  geom_bar(stat="identity", position=position_dodge(width=0.9)) + 
  scale_fill_manual(values=c("#56B4E9", "#009E73"))+
  geom_errorbar(limits, width = .2, position=position_dodge(width=0.9))+
  #coord_cartesian(ylim = c(0, 1))+
  theme_classic(base_size=20)+
  labs(title="")+
  ylab("RT")+
  xlab("Proportion")+
  theme(legend.position="top",legend.direction="horizontal",legend.title = element_blank())

Exp3.RT75.plot
```


# Exp. 4
# TASK Accuracy Analysis


```{r}


ACC.all<-c()
ACC.all<-AllDatanew1[AllDatanew1$Subject%in%CorruptedData==FALSE,]
ACC.all<-ACC.all[ACC.all$block!="T",]
ACC.all$TrialType<-factor(ACC.all$TrialType)
ACC.analysis<-ddply(ACC.all,.(Subject,block.type,TrialType,TargetType),summarise,ACC=mean(task.ACC),RT=mean(vjout(RTs)$data))

#Print table of means
Exp4.tables <- ddply(ACC.analysis, c("block.type","TrialType","TargetType"), summarise,
               N    = length(ACC),
               mean = mean(ACC),
               sd   = sd(ACC),
               se   = sd / sqrt(N)
               )
kable(xtable(Exp4.tables),type="html")

#ANOVA TrialType X TargetType

aov.out<-aov(ACC~TrialType*TargetType*block.type + Error(Subject/(TrialType*TargetType*block.type)),ACC.analysis)
Exp4.ACC.table<-kable(xtable(aov.out),type="html")
Exp4.ACC.table


aov.out<-aov_car(ACC ~ TrialType*TargetType*block.type + Error(Subject/(TrialType*TargetType*block.type)), 
        data = ACC.analysis)

nice(aov.out, es = "pes", observed = NULL,
    correction = c("none"), MSE = TRUE,
    sig.symbols = c(" +", " *", " **", " ***"))

#print(summary(aov.out),digits=10)
#print(model.tables(aov.out,"means"),format="markdown")


limits <- aes(ymax =mean + se, ymin = mean - se)
Exp4.ACC.plot<-ggplot(Exp4.tables,aes(x=TrialType, y=mean,fill=TargetType))+
  geom_bar(stat="identity", position=position_dodge(width=.9)) + 
  scale_fill_manual(values=c("#56B4E9", "#009E73"))+
  geom_errorbar(limits, width = .2, position=position_dodge(width=.9))+
  coord_cartesian(ylim = c(0, 1))+
  theme_classic(base_size=15)+
  labs(title="Exp. 4")+
  ylab("Accuracy (%)")+
  xlab("Proportion")+
  theme(legend.position="top",legend.direction="horizontal")+
  facet_wrap(~block.type)
Exp4.ACC.plot


### Look just at block.type

ACC.all<-c()
ACC.all<-AllDatanew1[AllDatanew1$Subject%in%CorruptedData==FALSE,]
ACC.all<-ACC.all[ACC.all$block!="T",]
ACC.all$TrialType<-factor(ACC.all$TrialType)
ACC.analysis<-ddply(ACC.all,.(Subject,block.type),summarise,ACC=mean(task.ACC),RT=mean(vjout(RTs)$data))

Exp4.tables <- ddply(ACC.analysis, c("block.type"), summarise,
               N    = length(ACC),
               mean = mean(ACC),
               sd   = sd(ACC),
               se   = sd / sqrt(N)
               )
kable(xtable(Exp4.tables),type="html")

#ANOVA TrialType X TargetType

aov.out<-aov(ACC~block.type + Error(Subject/(block.type)),ACC.analysis)
Exp4.ACC.table<-kable(xtable(aov.out),type="html")
Exp4.ACC.table


aov.out<-aov_car(ACC ~ block.type + Error(Subject/(block.type)), 
        data = ACC.analysis)

nice(aov.out, es = "pes", observed = NULL,
    correction = c("none"), MSE = TRUE,
    sig.symbols = c(" +", " *", " **", " ***"))

#print(summary(aov.out),digits=10)
#print(model.tables(aov.out,"means"),format="markdown")


limits <- aes(ymax =mean + se, ymin = mean - se)
Exp4.ACC.plot<-ggplot(Exp4.tables,aes(x=block.type, y=mean,fill=block.type))+
  geom_bar(stat="identity", position=position_dodge(width=.9)) + 
  scale_fill_manual(values=c("#56B4E9", "#009E73"))+
  geom_errorbar(limits, width = .2, position=position_dodge(width=.9))+
  coord_cartesian(ylim = c(0, 1))+
  theme_classic(base_size=15)+
  labs(title="Exp. 4")+
  ylab("Accuracy (%)")+
  xlab("Proportion")+
  theme(legend.position="top",legend.direction="horizontal")
Exp4.ACC.plot
```

# Exp. 4
# TASK ACC Analysis of location as factor


```{r}


AllDatanew.ACC<-AllDatanew
AllDatanew.ACC<-AllDatanew[AllDatanew.ACC$block != "T",]
set1 <- subset(AllDatanew.ACC,TrialType=="highcolor" & TargetType=="color")
set1$totProp<-"HP_Task"
set2 <- subset(AllDatanew.ACC,TrialType=="highcolor" & TargetType=="letter")
set2$totProp<-"LP_Task"

set3 <- subset(AllDatanew.ACC,TrialType=="highletter" & TargetType=="letter")
set3$totProp<-"HP_Task"
set4 <- subset(AllDatanew.ACC,TrialType=="highletter" & TargetType=="color")
set4$totProp<-"LP_Task"

newData<-rbind(set1,set2,set3,set4)

#Print table of means
ACC.analysis<-ddply(newData,.(Subject,block.type,totProp,TargetType),summarise,ACC=mean(ACC))
Exp1.tables <- ddply(ACC.analysis, c("block.type","TargetType","totProp"), summarise,
               N    = length(ACC),
               mean = mean(ACC),
               sd   = sd(ACC),
               se   = sd / sqrt(N)
               )
kable(xtable(Exp1.tables),type="html")

#ANOVA Proportion x TargetType
ACC.analysis$Subject<-factor(ACC.analysis$Subject)
ACC.analysis$totProp<-factor(ACC.analysis$totProp)
aov.out<-aov(ACC~block.type*totProp*TargetType + Error(Subject/(block.type*totProp*TargetType)),ACC.analysis)
Exp1.ACC75.table<-kable(xtable(aov.out),type="html")
Exp1.ACC75.table

#print(summary(aov.out),digits=10)
#print(model.tables(aov.out,"means"),format="markdown")

limits <- aes(ymax = mean + se, ymin = mean - se)
Exp1.ACC75.plot<-ggplot(Exp1.tables,aes(x=block.type, y=mean,fill=totProp))+
  geom_bar(stat="identity", position=position_dodge(width=0.9)) + 
  scale_fill_manual(values=c("#56B4E9", "#009E73"))+
  geom_errorbar(limits, width = .2, position=position_dodge(width=0.9))+
  coord_cartesian(ylim = c(0, 1))+
  theme_classic(base_size=20)+
  labs(title="")+
  ylab("ACCuracy (%)")+
  xlab("Proportion Location")+
  theme(legend.position="top",legend.direction="horizontal",legend.title = element_blank())+
  facet_wrap(~TargetType)

Exp1.ACC75.plot


## Collapse over Targets (non-sig interaction)

ACC.analysis<-ddply(newData,.(Subject,block.type,totProp),summarise,ACC=mean(ACC))
Exp1.tables <- ddply(ACC.analysis, c("block.type","totProp"), summarise,
               N    = length(ACC),
               mean = mean(ACC),
               sd   = sd(ACC),
               se   = sd / sqrt(N)
               )
kable(xtable(Exp1.tables),type="html")


#Plot Proportion X TargetType
limits <- aes(ymax = mean + se, ymin = mean - se)
Exp1.ACC75.plot<-ggplot(Exp1.tables,aes(x=block.type, y=mean,fill=totProp))+
  geom_bar(stat="identity", position=position_dodge(width=0.9)) + 
  scale_fill_manual(values=c("#56B4E9", "#009E73"))+
  geom_errorbar(limits, width = .2, position=position_dodge(width=0.9))+
  coord_cartesian(ylim = c(0, 1))+
  theme_classic(base_size=20)+
  labs(title="")+
  ylab("ACCuracy (%)")+
  xlab("Proportion Location")+
  theme(legend.position="top",legend.direction="horizontal",legend.title = element_blank())

Exp1.ACC75.plot


#ANOVA block.type x proportion
ACC.analysis$Subject<-factor(ACC.analysis$Subject)
ACC.analysis$totProp<-factor(ACC.analysis$totProp)
aov.out<-aov(ACC~block.type*totProp + Error(Subject/(block.type*totProp)),ACC.analysis)
Exp1.ACC75.table<-kable(xtable(aov.out),type="html")
Exp1.ACC75.table

#Run pairwise t-tests with Holm correction

ACC.1<-ACC.analysis[ACC.analysis$block.type=="R.Context",]
print(with(ACC.1, pairwise.t.test(ACC,totProp, paired=T)))

ACC.1<-ACC.analysis[ACC.analysis$block.type == "T.Context",]
print(with(ACC.1, pairwise.t.test(ACC,totProp, paired=T)))
